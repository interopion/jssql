!function(a,b){"use strict";function c(a,d){var e=parseInt(a,10);return(isNaN(e)||!isFinite(e))&&(e=d===b?0:c(d)),e}function d(a){var b=arguments,c=b.length,d=0;return String(a||"").replace(/(%s)/g,function(a,e){return++d>c?e:b[d]})}function e(a){var b,c=a.length;if(0===c)return"";if(1===c)return f(a[0]);if(2==c)return f(a[0])+" or "+f(a[1]);var d,e=[];for(d=0;d<a.length;d++)e.push(f(a[d]));return b=e.pop(),"one of "+e.join(", ")+" or "+b}function f(a,b){return b=b||'"',b+String(a).replace(b,b+""+b)+b}function g(a){return r(a)?a:"function"==typeof a.toArray?g(a.toArray()):a&&"object"==typeof a&&"length"in a?Array.prototype.slice.call(a):[a]}function h(a){a="string"==typeof a?{message:a}:a||{message:"Unknown error"};var b,c,e,f=Array.prototype.slice.call(arguments,1),g=[];throw f.unshift(a.message),b=e=d.apply({},f),g.push("font-weight:bold;color:red;",b),b="%c%s","file"in a&&(b+="%c \n   file: %s",g.push("font-weight:bold;",a.file)),"line"in a&&(b+="%c \n   line: %i",g.push("font-weight:bold",a.line)),"col"in a&&(b+="%c \n column: %i",g.push("font-weight:bold",a.col)),"token"in a&&(b+="%c \n   char: %i",g.push("font-weight:bold",a.token[2]),"src"in a&&(c=Math.max(a.token[2]-50,0),b+="%c \n around: %c%s%c%s%c%s",g.push("font-weight:bold","color:#666","..."+a.src.substring(c,a.token[2]),"color:#000;font-weight:bold;background:orange;padding:3px;border-radius:3px;text-indent:5px;display:inline-block !important;",a.src.substring(a.token[2],a.token[3]).replace(/\n/g,"Â¬\n"),"color:#666",a.src.substr(a.token[3],50)+"..."))),g.unshift(b),console.log.apply(console,g),new SyntaxError(e)}function i(a){return String(a).replace(/^\s+|\s+$/,"")}function j(a,b){function c(){g++}function d(){g--}function e(a){f[h++]=a}var f=[],g=0,h=0;return K(a,e,c,d,b),f}function k(a,b,c){var d,e,f=arguments.length;if(!(2>f)&&a&&"object"==typeof a)if("[object Array]"==Object.prototype.toString.call(a)){for(e=a.length,d=0;e>d;d++)if(f>2){if(b.call(c,a[d],d,a)===!1)break}else if(b(a[d],d,a)===!1)break}else for(d in a)if(f>2){if(b.call(c,a[d],d,a)===!1)break}else if(b(a[d],d,a)===!1)break}function l(a,b,c){var d,e,f=arguments.length;if(2>f||!a||"object"!=typeof a)return!1;if("[object Array]"==Object.prototype.toString.call(a)){if("function"==typeof a.every)return a.every(b,c);for(e=a.length,d=0;e>d;d++)if(f>2){if(b.call(c,a[d],d,a)===!1)return!1}else if(b(a[d],d,a)===!1)return!1}else for(d in a)if(f>2){if(b.call(c,a[d],d,a)===!1)return!1}else if(b(a[d],d,a)===!1)return!1;return!0}function m(a,b){var c,d=[];for(c in a)(b||a.hasOwnProperty(c))&&d.push(c);return d}function n(){}function o(a,b){var c;if(a){if(c=zb.databases[a],!c){if(b===!1)return null;throw new Zb('No such database "%s"',a)}}else if(c=zb.currentDatabase,!c){if(b===!1)return null;throw new Zb("No database selected.")}return c}function p(a,b,c){var d,e=o(b,c);if(!e)return null;if(d=e.tables[a],!d){if(c===!1)return null;throw new Zb('No such table "%s" in database "%s"',a,e.name)}return d}function q(a,b,c,d,e){if(d=d||zb.currentDatabase,!d)throw new Zb("No database selected");return d.createTable(a,b,c,e)}function r(a){return"[object Array]"==Object.prototype.toString.call(a)}function s(a){return"[object Function]"==Object.prototype.toString.call(a)}function t(a){var b=parseFloat(a);return!isNaN(b)&&isFinite(b)}function u(a,c,d,e,f){var g,h;if(e===b)e=0;else if(e=0|e,0>e||e>=a.length)throw new RangeError("invalid lower bound");if(f===b)f=a.length-1;else if(f=0|f,e>f||f>=a.length)throw new RangeError("invalid upper bound");for(;f>=e;)if(g=e+(f-e>>1),h=+d(a[g],c),0>h)e=g+1;else{if(!(h>0))return g;f=g-1}return~e}function v(a,b,c){if(Object.prototype.toString.call(a).toLowerCase()!="[object "+b+"]")throw new TypeError(c||"Invalid type ('"+b+"' is required)")}function w(a,b,c){if(!(a instanceof b))throw new TypeError(c||"Invalid object type")}function x(a,b,c){if(0>a||a>=b.length)throw new RangeError(c||"value out of bounds")}function y(a,b,c){if(!(a in b))throw new Error(c||"No such property '"+a+"'.")}function z(a,b){if(!a)throw new Error(b||"Assertion failed")}function A(a){Eb.debug&&window.console&&console.error&&console.error(a)}function B(a){return s(a)?a:function(a){if(a)throw a}}function C(){var a,b,c,d,e,f,g=arguments.length;if(!(1>g)){if(e=arguments[0],1===g)return C(r(e)?[]:{},e);for(d=1;g>d;d++)if(f=arguments[d],r(f))for(b=f.length,a=0;b>a;a++)c=f[a],e[a]=c&&"object"==typeof c?C(r(c)?[]:{},e[a],c):c;else if(f&&"object"==typeof f)for(a in f)f.hasOwnProperty(a)&&(c=f[a],e[a]=c&&"object"==typeof c?C(r(c)?[]:{},e[a],c):c);return e}}function D(a){var b,c=[],d=[],e=a.sandbox||{},f=a.translations||{},g=a.scope||{},h=a.code||"",i=a.context||null===a.context?a.context:{};for(b in e)c.push(b),d.push(e[b]);for(b in g)h=h.replace(new RegExp("\\b"+b+"\\b","gi"),"__scope__['"+b+"']");c.push("__scope__"),d.push(g);for(b in f)h=h.replace(new RegExp(b,"gi"),f[b]);return h=h.replace(/^(\s*return\s+)?/,"return "),new Function(c.join(", "),h).apply(i,d)}function E(a,b){return D({code:a,sandbox:{},translations:{"={1,}":"===","\\bOR\\b":"||","\\bAND\\b":"&&","!={1,}":"!==","(__scope__\\[[^\\]]+\\])\\s*LIKE\\s*('[^']*')":function(a,b,c){return"LIKE("+b+", "+c+")"}},scope:b,context:{}})}function F(a){for(var b,c,d,e,f,g,h,i=a.length,j=0,k=[];i>j;){if(g=a[j],c=g.length,0===j)for(b=0;c>b;b++)e=k.push(C(g[b]));else for(d=0;e>d;d++)for(f=C(k[d]),h=0,b=0;c>b;b++)1===++h?C(k[d],g[b]):(k.splice(++d,0,C({},f,g[b])),e++);j++}return k}function G(a){for(var b,c,d,e,f,g,h,i=a.slice(),j=i.length,k=0;j--;)if(c=i.shift(),b)for(g=0;k>g;g++){h=0,f=b[g];for(d in c.rows)e=f.concat(c.rows[d]._data),1===++h?b[g]=e:(b.splice(++g,0,e),k++)}else{b=[];for(d in c.rows)k=b.push(c.rows[d]._data.slice())}return b||[]}function H(a,b){console.time("innerJoin");var c=G(a).filter(b);return console.timeEnd("innerJoin"),c}function I(a,b){var c=function(){this.name=a,this.message=d.apply(this,arguments.length?arguments:[b||"Unknown error"])};return c.prototype=new Error,c.prototype.constructor=c,c}function J(){function a(){return!1}function b(b,c){return c===!1&&(c=a),e[b]||(e[b]=[]),e[b].push(c),c}function c(c,e){function g(){var a=e.apply(f,arguments);return d(c,g),a}return e===!1&&(e=a),b(c,g),g}function d(b,c){if(c===!1&&(c=a),b)if(c)for(var d=e[b]||[],f=d.length;f--;)d[f]===c&&e[b].splice(f,1);else e[b]=[];else e={}}var e={},f=this;this.dispatch=function(a){var b,c=e[a]||[],d=c.length,f=!1,g=Array.prototype.slice.call(arguments,0);for(b=0;d>b;b++)if(c[b].apply(this,arguments)===!1){f=!0;break}return"*"!=a&&(g.unshift("*"),this.dispatch.apply(this,g)),!f},this.bind=b,this.unbind=d,this.one=c,this.on=b,this.off=d}function K(a,b,c,d,e){function f(b){var c=Array.prototype.slice.call(arguments,1);c.unshift({message:b,line:p,col:q,pos:m,src:a,token:i}),h.apply({},c)}function g(){var a,c=t&&o===Qb||u&&o===Rb||v&&(o===Nb||o===Ob)||w&&o===Pb&&("'"==n||'"'==n||"`"==n);c||(i=[n,o||(/^-?\d+$/.test(n)?Hb:n in Vb?Ib:Gb),r,m],a=b(i)),n="",o=Fb,r=m,a&&a!==!0?f(a):a===!1&&(m=-1)}for(var i,j,k,l,m=0,n="",o=Fb,p=1,q=0,r=0,s=e||{},t=!!s.skipSpace,u=!!s.skipEol,v=!!s.skipComments,w=!!s.skipStrQuots;j=a[m];){switch(l=o===Jb||o===Kb||o===Lb||o===Ob||o===Nb,j){case"-":l?n+=j:"-"==a[m+1]?(n&&g(),n=j,o=Nb):(o!==Hb&&(a[m+1]||"").match(/[0-9]/)?(n&&g(),o=Hb):o!==Ib&&(n&&g(),o=Ib),n+=j),m++;break;case"/":o===Jb||o===Kb||o===Lb||o===Nb?(n+=j,m++):o===Ob?(n+=j,m++,"*"==a[m-2]&&n&&g()):"*"==a[m+1]?(n&&g(),n+=j,o=Ob,m++):(o!==Ib&&(n&&g(),o=Ib),n+=j,m++);break;case"\n":p++,l&&o!==Nb?(n+=j,m++,q=0):(n&&g(),o=Rb,n+=j,m++,q=0,g());break;case"'":o===Jb?a[m+1]==j?(n+=j,m+=2):(g(),n+=j,m++,o=Pb,g()):l?(n+=j,m++):(n&&g(),n+=j,m++,o=Pb,g(),o=Jb);break;case'"':o===Kb?a[m+1]==j?(n+=j,m+=2):(g(),n+=j,m++,o=Pb,g()):l?(n+=j,m++):(n&&g(),n+=j,m++,o=Pb,g(),o=Kb);break;case"`":o===Lb?a[m+1]==j?(n+=j,m+=2):(g(),n+=j,m++,o=Pb,g()):l?(n+=j,m++):(n&&g(),n+=j,m++,o=Pb,g(),o=Lb);break;case"(":l?(n+=j,m++):(n&&g(),o=Pb,n=j,m++,g(),c());break;case")":l?(n+=j,m++):(n&&g(),d(),o=Pb,n=j,m++,g());break;case";":l?(n+=j,m++):(n&&g(),m++,o=Mb,n=j,g());break;case" ":case"	":l||o===Qb||(n&&g(),o=Qb),n+=j,m++;break;case"!":l?(n+=j,m++):(n&&g(),o=Ib,n+=j,k=a[m+1],("="==k||"<"==k||">"==k)&&(n+=k,m++),g(),m++);break;case"<":l?(n+=j,m++):(n&&g(),o=Ib,n+=j,k=a[m+1],("="==k||">"==k)&&(n+=k,m++),g(),m++);break;case">":l?(n+=j,m++):(n&&g(),o=Ib,n+=j,k=a[m+1],"="==k&&(n+=k,m++),g(),m++);break;case"=":case"+":case"-":case"*":case"/":case"%":l?(n+=j,m++):(n&&g(),o=Ib,n+=j,m++,g());break;case".":l?n+=j:n&&/^-?\d+$/.test(n)?(o=Hb,n+=j):(n&&g(),k=a[m+1],k&&/[0-9]/.test(k)?(o=Hb,n+=j):(o=Pb,n+=j,g())),m++;break;case",":l?n+=j:(n&&g(),o=Pb,n+=j,g()),m++;break;case"\\":switch(m++,k=a[m],m++,k){case"0":n+="\x00";break;case"b":n+="\b";break;case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="	";break;case"%":n+="\\%";break;case"_":n+="\\_";break;default:n+=k}break;default:o===Qb&&n&&g(),n+=j,m++}q++}if(n&&g(),o===Jb)throw"Unexpected end of input. Expecting '.";if(o===Kb)throw'Unexpected end of input. Expecting ".';if(o===Lb)throw"Unexpected end of input. Expecting `.";if(o===Ob)throw"Unexpected end of input. Expecting */.";s.addEOF&&(o=Sb,g())}function L(a,b){this._tokens=[],this.init(a,b)}function M(a){function c(){d(!0),v.off()}function d(a){if(f()&&!h())throw new Error("Cannot reset a transacion while it is runing");q&&clearTimeout(q),r&&clearTimeout(r),n=[],o=0,p=-1,q=null,t=0,u="",a||v.dispatch("reset")}function e(){var a,b=0;for(a=0;p>=a;a++)b+=n[a].weight||1;return b/t}function f(){return p>-1}function g(){return 0===o}function h(){return!g()&&p===o-1}function i(a){if(a&&a instanceof M){var b=a;a=M.createTask({name:"Nested transaction",execute:function(a){b.on("complete",a),b.on("error",a),b.start()},undo:function(a){b.on("rollback",function(){var c=Array.prototype.slice.call(arguments);c.unshift(null),a.apply(b,c)}),b.rollback()}}),b.parentTransaction=m,t+=b.getWeight()}else t+=a.weight||1,m.parentTransaction&&m.parentTransaction.setWeight(m.parentTransaction.getWeight()+(a.weight||1));a.transaction=m,o=n.push(a),a.name+=" (at position "+o+")"}function j(a){q&&clearTimeout(q),r&&clearTimeout(r),(a===b||a===p)&&(h()||g()?v.dispatch("complete"):!function(a,b){var c="timeout"in a?a.timeout:l.timeout;c>0&&(q=setTimeout(function(){u="Task '"+a.name+"' timed out!.",v.dispatch("error",u),l.autoRollback&&k(b)},c+l.delay));try{v.dispatch("before:task",a,b),a.execute(function(c){b===p&&(c?(u=c||"Task '"+a.name+"' failed.",v.dispatch("error",u),l.autoRollback&&k(b)):(v.dispatch("progress",e(),a,b),v.dispatch("after:task",a,b),r=setTimeout(j,l.delay)))})}catch(d){v.dispatch("error",d),l.autoRollback&&k(b)}}(n[++p],p))}function k(a){if(q&&clearTimeout(q),r&&clearTimeout(r),a===b||a===p)if(0>p)v.dispatch("rollback",u);else try{var c=n[p--];v.dispatch("before:undo",c,p+1),c.undo(function(a){a?(v.dispatch("progress",e(),c,p+1),v.dispatch("after:undo",c,p+1),v.dispatch("error",a||"Task '"+c.name+"' failed to undo"),k()):(v.dispatch("progress",e(),c,p+1),v.dispatch("after:undo",c,p+1),k())})}catch(d){v.dispatch("error",d),k()}}var l=C({timeout:1e3,delay:0,name:"Anonymous transaction",autoRollback:!0},a),m=this,n=[],o=0,p=-1,q=null,r=null,t=0,u="",v=new J;Eb.debug&&(v.on("error",function(a,b){console.error(b)}),v.on("before:task",function(a,b){console.info("Starting task ",l.name,"->",b.name)}),v.on("complete",function(){console.info('Transaction complete "%s"',l.name)}));var w={onComplete:"complete",onRollback:"rollback",onError:"error",beforeTask:"before:task",afterTask:"after:task",beforeUndo:"before:undo",afterUndo:"after:undo",onProgress:"progress"};for(var x in w)s(l[x])&&v.on(w[x],l[x]);this.bind=v.bind,this.on=v.on,this.one=v.one,this.unbind=v.unbind,this.off=v.off,this.getLength=function(){return o},this.getWeight=function(){return t},this.setWeight=function(a){t=a},this.start=function(){if(h())throw new Error("The transaction is already complete");if(f())throw new Error("The transaction is already running");v.dispatch("start"),j()},this.reset=d,this.destroy=c,this.add=i,this.rollback=k,this.isStarted=f,this.isComplete=h,this.isEmpty=g,this.getProgress=e,this.setOption=function(a,b){return l[a]=b,this},this.getOption=function(a){return l[a]},this.next=j}function N(a){C(this,a)}function O(){}function P(a){function b(a){a[2]+=l,a[3]+=l,d=a[3],e.tokens.push(a)}a=Q(a);for(var c,d,e,f,g=new O,h=j(a,{skipComments:!0,skipSpace:!0,skipEol:!0,skipStrQuots:!0}),i=new L(h,a),k=h.length,l=0;i._pos<k-1&&(e={sql:"",tokens:[]},c=d=i.current()[2],i.nextUntil(";",b),i.is(";"))&&(f=i.current(),f[2]+=l,d=f[3],f[3]+=l,e.tokens.push(f),e.sql=a.substring(c,d),e.sql&&";"!=e.sql&&g.push(e),l=-d-1,i.next()););return g}function Q(a){return r(a)?a instanceof O?a:a.map(Q).join("").trim():String(a).trim().replace(/(.*?);*?$/,"$1;")}function R(a,b){S(a,function(a,c){b(null,a,c)},function(a,c){var d=a&&a instanceof Error?a:new Error(String(a||"Unknown error"));b(d,null,c)})}function S(a,c,d){function e(a,d){a!==b&&c(a,d||k)}function f(a,b){(d||A)(a&&a instanceof Error?a:new Error(String(a||"Unknown error")),b)}function g(a,b,c,d){return function(){var g,h=Bb[a],i=zb.getTransaction(),j=new vb;if(i)i.add(M.createTask({name:a,execute:function(a){var d,f=new vb;try{d=h(b),d.execute(function(b,g){b?d.undo(function(){a(b)}):(f.setData(g),e(f,c),a())})}catch(g){a(g)}},undo:function(a){a()}})),j.setData(a+" query added to the transaction"),e(j,c),d();else try{g=h(b),g.execute(function(a,b){a?(f(a,c),g.undo(n,n)):(j.setData(b),e(j,c),d())})}catch(k){f(k,c)}}}function h(a){var b=i[a];if(b){var c=function(){h(a+1)},d=new L(b.tokens,b.sql);d.pick({BEGIN:g("BEGIN",d,a,c),"COMMIT|END":function(){var b,g=zb.getTransaction();return g?(b=new vb,void(g.isEmpty()?(Bb.COMMIT(d).execute(n,f),b.setData("Empty transaction committed"),e(b,a),c()):(b.setData("Transaction committed"),e(b,a),g.one("complete",function(){b.setData("Transaction complete"),e(b,a),setTimeout(c,0)}),g.one("rollback",function(b){f("Transaction rolled back!"+(b?"\n"+b:""),a),setTimeout(c,0)}),Bb.COMMIT(d).execute(n,f)))):void f("There is no transaction to commit",a)},ROLLBACK:function(){var b,g=zb.getTransaction();return g?(b=new vb,void(g.isEmpty()?(Bb.ROLLBACK(d).execute(n,f),b.setData("Empty transaction rolled back"),e(b,a),c()):(g.one("rollback",function(){b.setData("Transaction rolled back!"),e(b,a),setTimeout(c,0)}),Bb.ROLLBACK(d).execute(n,f)))):void f("There is no transaction to rollback",a)},SHOW:function(){d.pick({"DATABASES|SCHEMAS":g("SHOW_DATABASES",d,a,c),TABLES:g("SHOW_TABLES",d,a,c),COLUMNS:g("SHOW_COLUMNS",d,a,c)})},CREATE:function(){d.pick({"DATABASE|SCHEMA":g("CREATE_DATABASE",d,a,c),TABLE:g("CREATE_TABLE",d,a,c),"TEMPORARY TABLE":g("CREATE_TABLE",d,a,c)})},DROP:function(){d.pick({"DATABASE|SCHEMA":g("DROP_DATABASE",d,a,c),TABLE:g("DROP_TABLE",d,a,c),"TEMPORARY TABLE":g("DROP_TABLE",d,a,c)})},SELECT:g("SELECT",d,a,c),USE:g("USE",d,a,c),UPDATE:g("UPDATE",d,a,c),INSERT:g("INSERT",d,a,c),DELETE:g("DELETE",d,a,c),SOURCE:g("SOURCE",d,a,c)})}}var i=a instanceof O?a:P(a),j=i.length,k=0;if(j)try{h(0)}catch(l){f(l)}else c(new vb("No queries executed"))}function T(){if(!window.localStorage||!s(localStorage.setItem))throw new Error("localStorage is not supported");this.setMany=function(a,b){setTimeout(function(){var c=null;try{for(var d in a)localStorage.setItem(d,a[d])}catch(e){c=e}b&&b(c)},0)},this.getMany=function(a,b){setTimeout(function(){var c=null,d=[];try{for(var e=0,f=a.length;f>e;e++)d.push(localStorage.getItem(a[e]))}catch(g){c=g}b&&b(c,d)},0)},this.unsetMany=function(a,b){setTimeout(function(){var c=null;try{for(var d=0,e=a.length;e>d;d++)localStorage.removeItem(a[d])}catch(f){c=f}b&&b(c)},0)},this.set=function(a,b,c){setTimeout(function(){var d=null;try{localStorage.setItem(a,b)}catch(e){d=e}c&&c(d)},0)},this.get=function(a,b){setTimeout(function(){var c,d=null;try{c=localStorage.getItem(a)}catch(e){d=e}b&&b(d,c)},0)},this.unset=function(a,b){setTimeout(function(){var c=null;try{localStorage.removeItem(a)}catch(d){c=d}b&&b(c)},0)}}function U(){var a={};this.setMany=function(b,c){setTimeout(function(){var d=null;try{for(var e in b)a[e]=b[e]}catch(f){d=f}c&&c(d)},0)},this.getMany=function(b,c){setTimeout(function(){var d,e=null,f=[];try{for(var g=0,h=b.length;h>g;g++)d=b[g],f.push(d in a?a[d]:null)}catch(i){e=i}c&&c(e,f)},0)},this.unsetMany=function(b,c){setTimeout(function(){var d=null;try{for(var e=0,f=b.length;f>e;e++)a.hasOwnProperty(b[e])&&delete a[b[e]]}catch(g){d=g}c&&c(d)},0)},this.set=function(b,c,d){setTimeout(function(){var e=null;try{a[b]=c}catch(f){e=f}d&&d(e)},0)},this.get=function(b,c){setTimeout(function(){var d,e=null;try{d=b in a?a[b]:null}catch(f){e=f}return c&&c(e,d),d})},this.unset=function(b,c){setTimeout(function(){var d=null;try{a.hasOwnProperty(b)&&delete a[b]}catch(e){d=e}c&&c(d)},0)}}function V(){function a(a,c){var f=window.requestFileSystem||window.webkitRequestFileSystem,g=d.fileSystem.type,h=window.Cordova?0:d.fileSystem.size;return f?void(g===e&&h>0?b(h,function(b){f(g,b,a,c)}):f(g,h,a,c)):c("It seems that 'requestFileSystem' is not supported by this browser")}function b(a,b,c){navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota?navigator.webkitPersistentStorage.requestQuota(a||0,b,c):c("The Quota API is not supported")}function c(a,b){var c,d;if("function"==typeof b&&(b={onloadend:b}),!a){if(b.onerror)return void b.onerror(new Error("No file"));throw"No file"}d=C({readAs:"text",encoding:"UTF-8",onloadend:n,onerror:n},b),c=new FileReader,k(["onloadstart","onprogress","onload","onabort","onerror","onloadend"],function(a){s(d[a])&&(c[a]=d[a])});try{switch(d.readAs){case"text":c.readAsText(a,d.encoding);break;case"binary":c.readAsBinaryString(a);break;case"dataURL":c.readAsDataURL(a);break;case"arrayBuffer":c.readAsArrayBuffer(a);break;default:throw new Error("Invalid argument")}}catch(e){console.error(e),d.onerror(e)}}{var d={fileSystem:{size:15728640,type:window.PERSISTENT}},e=window.PERSISTENT;window.TEMPORARY}this.set=function(b,c,d){var e=b+".json",f=B(d),g=function(a){f(a)};a(function(a){a.root.getFile(e,{create:!0,exclusive:!1},function(a){a.createWriter(function(a){a.onwriteend=function(){f(null,c)},a.onerror=function(a){g("Write failed: "+a)};var b=new Blob([String(c)],{type:"text/plain"});a.write(b)},g)},g)},g)},this.get=function(b,d){var e=b+".json",f=B(d),g=function(a){f(a)};a(function(a){a.root.getFile(e,{create:!0,exclusive:!1},function(a){a.file(function(a){c(a,{readAs:"text",onerror:g,onabort:g,onloadend:function(a){f(null,a.target.result||null)}})},g)},g)},g)},this.unset=function(b,c){var d=b+".json",e=B(c),f=function(a){e(a)};a(function(a){a.root.getFile(d,{create:!1,exclusive:!1},function(a){a.remove(function(){e(null,null)},f)},function(){e(null,null)})},f)},this.setMany=function(b,c){var d=!1,e=function(a){d=!0,c(a)};a(function(a){function f(){if(d)return!1;if(!g.length)return c(null);var b=g.shift();a.root.getFile(b.path,{create:!0,exclusive:!1},function(a){a.createWriter(function(a){a.onwriteend=f,a.onerror=function(a){e("Write failed: "+a)};var c=new Blob([String(b.value)],{type:"text/plain"});a.write(c)},e)},e)}var g=[];k(b,function(a,b){g.push({path:b+".json",value:a})}),f()},e)},this.getMany=function(b,d){var e=b.slice(),f=[],g=!1,h=function(a){g=!0,d(a)};a(function(a){function b(){return g?!1:e.length?void a.root.getFile(e.shift()+".json",{create:!0,exclusive:!1},function(a){a.file(function(a){c(a,{readAs:"text",onerror:h,onabort:h,onloadend:function(a){f.push(a.target.result||null),b()}})},h)},h):d(null,f)}b()},h)},this.unsetMany=function(b,c){var d=b.slice(),e=!1,f=function(a){e=!0,c(a)};a(function(a){function b(){return e?!1:d.length?void a.root.getFile(d.shift()+".json",{create:!1,exclusive:!1},function(a){a.remove(b,f)},b):c(null)}b()},f)}}function W(){}function X(){var a=null;this.databases={},this.isInTransaction=function(){return!!a},this.getTransaction=function(){return a||null},this.beginTransaction=function(b){function c(){a.destroy(),a=null}if(a)throw new Zb("There is a current transaction already started");return a=new M(b),a.on("rollback",function(a,b){Eb.debug&&console.warn("Transaction rolled back with error ",b),c()}),a.on("complete",function(){Eb.debug&&console.info("Transaction complete"),c()}),Eb.debug&&(a.on("before:task",function(a,b){console.info('Starting task "%s"',b.name)}),a.on("after:task",function(a,b){console.info('Ended task "%s"',b.name)})),a},this.commitTransaction=function(){if(!a)throw new Zb("There is no current transaction");a.start()},this.rollbackTransaction=function(b){a||b(new Zb("There is no current transaction")),b&&a.one("rollback",function(){b()}),a.rollback()}}function Y(a){this.tables={},this.name=a}function Z(a,b){this.name=a,this.rows={},this.keys={},this.cols={},this._col_seq=[],this._row_seq=[],this._length=0,this._ai=1,this._db=b}function $(){this.typeParams=[]}function _(){}function ab(){}function bb(){}function cb(){}function eb(){}function fb(){}function gb(){}function hb(){}function ib(){}function jb(){}function kb(){}function lb(){}function mb(){}function nb(){}function ob(){}function pb(){}function qb(a,b){this.id=b,this.table=null,this.length=0,this._data=[],this._cellsByName={},a&&this.setTable(a)}function rb(a,b,c,d){this.columns=[],this._index=[],this.setTable(a),this.setType(c),this.setName(d||b.join("_")),this.setColumns(b),this.init()}function sb(){}function tb(){}function ub(){this.columns=[],this.constraints=[]}function vb(a){this.data=null,this.type=vb.TYPE_UNKNOWN,this.cols=[],this.rows=[],this._startTime=Date.now(),this._endTime=0,this.time=0,this.colLength=0,this.rowLength=0,arguments.length&&this.setData(a)}function wb(a,b){b||(b=a,a={}),C(Eb,a),s(b)&&(Db.SERVER.loaded?b(cc):Db.events.one("load:server",function(){b(cc)}))}function xb(a){return a===b?C({},Eb):void C(Eb,a)}function yb(a,b){R(a,function(a,c){if(a)throw a;c&&c.rows&&c.rows.forEach(b)})}var zb,Ab,Bb={},Cb="JSDB",Db={},Eb={debug:!1},Fb=0,Gb=1,Hb=2,Ib=3,Jb=4,Kb=5,Lb=6,Mb=7,Nb=8,Ob=9,Pb=10,Qb=13,Rb=14,Sb=15,Tb=[Gb,Kb,Jb,Lb],Ub=[Hb,Kb,Jb,Lb],Vb={ALL:1,AND:1,ANY:1,BETWEEN:1,EXISTS:1,IN:1,LIKE:1,NOT:1,OR:1,IS:1,UNIQUE:1,IF:1,"!=":1,"<>":1,">=":1,"<=":1,"!<":1,"!>":1,"=":1,">":1,"<":1,"+":1,"-":1,"*":1,"/":1,"%":1},Wb=["BIT","TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","REAL","DOUBLE","FLOAT","DECIMAL","NUMERIC","DATE","TIME","TIMESTAMP","DATETIME","YEAR","CHAR","VARCHAR","BINARY","VARBINARY","TINYBLOB","BLOB","MEDIUMBLOB","LONGBLOB","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","ENUM","SET"],Xb={};Xb[Fb]="character",Xb[Gb]="word",Xb[Hb]="number",Xb[Ib]="operator",Xb[Jb]="string",Xb[Kb]="string",Xb[Lb]="string",Xb[Mb]="character",Xb[Nb]="comment",Xb[Ob]="comment",Xb[Pb]="punctoator",Xb[Qb]="space",Xb[Rb]="new line";var Yb=(I("CustomError"),I("SQLParseError","Error while parsing sql query")),Zb=I("SQLRuntimeError","Error while executing sql query"),$b=I("SQLConstraintError","SQL constraint violation"),_b=new J;L.prototype={_pos:0,_input:"",init:function(a,b){this._pos=0,this._tokens=a||[],this._input=b||""},back:function(a){if(a=c(a||1,1),1>a)throw new Error("Invalid argument (expecting positive integer)");if(this._pos-a<0)throw new Error("The parser is trying go before the first token");return this._pos-=a,this},forward:function(a){if(a=c(a||1,1),1>a)throw new Error("Invalid argument (expecting positive integer)");if(!this._tokens[this._pos+a])throw new Error("The parser is trying go after the last token");return this._pos+=a,this},next:function(){return this._tokens[this._pos+1]?(this._pos++,this.current()):!1},prev:function(){return this._tokens[this._pos-1]?(this._pos--,this.current()):!1},current:function(){return this._tokens[this._pos]},get:function(){return this._tokens[this._pos]?this._tokens[this._pos][0]:""},is:function(a,b){var d,e,f,g,h=this.current(),i=h?h[0]:"";if(a.indexOf("|")>0){for(d=a.split(/\s*\|\s*/),g=0;g<d.length;g++)if(this.is(d[g],b))return!0;return!1}if(a.indexOf("&")>0){for(e=!1,d=a.split(/&+/),g=0;g<d.length;g++)if(!this.is(d[g],b))return!1;return!0}if(a.indexOf(" ")>0){for(e=!1,f=this._pos,d=a.split(/\s+/),g=0;g<d.length;g++){if(!this.is(d[g],b))return this._pos=f,!1;this._pos++}return this._pos=f,!0}if("!"==a[0])return!this.is(a.substr(1));if("@"==a[0]){var j=c(a.substr(1));return h?h[1]===j:!1}return b?a===i:a.toUpperCase()===i.toUpperCase()},require:function(a,b){if(!this.is(a,b)){var c="the start of the query";throw this._pos>0&&(c=this._input.substring(0,this._tokens[this._pos][2]),c=c.substring(c.lastIndexOf(this.lookBack(5)[0])),c=c.replace(/[\r\n]/,"").replace(/\t/," "),c=c.replace(/\s+$/,""),c="..."+c),new Yb("You have an error after %s. Expecting %s. The query was %s",c,a,this._input)}},some:function(a,b){function c(){i=!0}var d,f,g,h,i,j=this._tokens[this._pos],k=[];if(j){for(d in a){if(d.indexOf("|")>0){for(f=d.split(/\s*\|\s*/),g=0;g<f.length;g++)if(b&&f[g]===j[0]||!b&&f[g].toUpperCase()===j[0].toUpperCase())return this._pos++,a[d].call(this),this}else if(d.indexOf(" ")>0){if(i=!1,this.optional(d,c),i)return a[d].call(this),this}else if(b&&d===j[0]||!b&&d.toUpperCase()===j[0].toUpperCase())return this._pos++,a[d].call(this),this;k.push(d)}throw h="the start of the query",this._pos>0&&(h=this._input.substring(0,this._tokens[this._pos][2]),h=h.substring(h.lastIndexOf(this.lookBack(5)[0])),h=h.replace(/[\r\n]/,"").replace(/\t/," "),h=h.replace(/\s+$/,""),h="..."+h),new Yb('Expecting: %s after "%s". The query was %s',e(k),h,this._input)}return this},any:function(a,b,c){var d,f,g,h=this._tokens[this._pos];if(h)for(a="[object Array]"==Object.prototype.toString.call(a)?a:[a],d=a.length,g=0;d>g;g++)if(f=a[g],f.toUpperCase()===h[0].toUpperCase())return this._pos++,b(h),this;throw c&&c(h),new Yb("Expecting: %s. The query was %s",e(a),this._input)},pick:function(a){return this.some(a)},optional:function(a,b){var c,d=this;if(!a)return this;if("string"==typeof a){var e,f=i(a).toUpperCase().split(/\s+/),g=this.lookAhead(f.length);if(f.join(" ")===g.join(" ").toUpperCase())this._pos+=f.length,b.call(this);else{for(e=0;e<f.length&&e<g.length&&f[e]===g[e].toUpperCase();e++);if(e>0)throw new Yb('Expecting "%s" after "%s". The query was %s',f[e],g[e-1],d._input)}}else"object"==typeof a&&("[object Array]"==Object.prototype.toString.call(a)?l(a,function(b){var e=!1;return l(b,function(b,f){return c=d._pos,d.optional(f,function(){e=!0,d._tokens.splice(c,d._pos-c),d._pos=c,b(),d.optional(a)}),!e}),!e}):l(a,function(a,b){var c=!1;return this.optional(b,function(){c=!0,a()}),!c},this));return this},someType:function(a,b,c){var d,f,g=this._tokens[this._pos],h=[];if(g){for(d in a){if(a[d]===g[1])return this._pos++,b(g),this;f=Xb[a[d]],-1==h.indexOf(f)&&h.push(Xb[a[d]])}throw new Yb("Expecting: %s %s. The query was %s",e(h),c||"",this._input)}return this},lookAhead:function(a){var b,c=[],d=this._pos,e=d+a;for(d=this._pos;e>d;d++)b=this._tokens[d],b&&c.push(b[0]);return c},lookBack:function(a){var b,c,d=[],e=this._pos-Math.abs(a);for(b=this._pos-1;b>=e&&b>=0;b--)c=this._tokens[b],c&&d.unshift(c[0]);return d},nextUntil:function(a,b){for(;!this.is(a)&&(b&&b.call(this,this.current()),this.next()););return this},errorUntil:function(a){return this.nextUntil(a,function(a){throw new Yb('Unexpected %s "%s". The query was %s',Xb[a[1]],a[0],this._input)})},commit:function(a){var b=this._tokens[this._pos];return b&&";"==b[0]&&(this._pos++,a()),this},literalValue:function(a){var b=this._tokens[this._pos],c=Ub,d=["NULL","CURRENT_TIME","CURRENT_DATE","CURRENT_TIMESTAMP"],f=["number","string","NULL","CURRENT_TIME","CURRENT_DATE","CURRENT_TIMESTAMP"];if(d.indexOf(b[0])>-1)return this._pos++,a&&a.call(this,b),this;if(c.indexOf(b[1])>-1)return this._pos++,a&&a.call(this,b),this;throw new Yb('Unexpected %s "%s". Expecting %s. The query was %s',Xb[b[1]],b[0],e(f),this._input)},commaSeparatedList:function(a){var b=this._tokens[this._pos],c=this;if(","==b[0])throw new Yb('Unexpected ",". The query was %s',this._input);return this._pos++,a.call(this,b),this.optional({",":function(){c.commaSeparatedList(a)}}),this},commaSeparatedBlock:function(a,b){var c=this,d=this._pos;return this.pick({"(":function(){var e=c._tokens[c._pos];if(","==e[0])throw new Yb('Unexpected ",". The query was %s',c._input);if(c.commaSeparatedList(a),e=c._tokens[c._pos++],")"!=e[0]){var f="";throw d>0&&(f=c._input.substring(c._tokens[d][2],c._tokens[c._pos][2]),f=f.replace(/\n/,"")),new Yb('Expecting ")" after %s. The query was %s',f||"the start of the query",c._input)}b&&b.call(c)}}),this}},M.createTask=function(a){return new N(a)},N.prototype={name:"Anonymous task",execute:function(a){console.warn("The 'execute' method for task '"+this.name+"' is not implemented!"),a()},undo:function(a){console.warn("The 'undo' method for task '"+this.name+"' is not implemented!"),a()}},L.prototype.walkOnConflictClause=function(a){var b=null,c=this;return c.optional({"ON CONFLICT":function(){c.pick({"ROLLBACK|ABORT|FAIL|IGNORE|REPLACE":function(){b=this.prev()[0].toUpperCase()}})}}),a&&a.call(c,b),c},L.prototype.walkIndexedColumn=function(a){var b={},c=this;return this.someType(Tb,function(a){b.name=a[0]}).optional({COLLATE:function(){c.someType(Tb,function(a){b.collation=a[0]})}}).optional({ASC:function(){b.sortOrder="ASC"},DESC:function(){b.sortOrder="DESC"}}),a&&a.call(this,b),this},Bb.USE=function(a){function b(a){c?(zb.setCurrentDatabase(c.name),a(null,'Current database restored to "'+c.name+'".')):a()}var c=zb.getCurrentDatabase();return new N({name:"Use Database",execute:function(b){var d;a.someType(Tb,function(a){d=a[0]}).errorUntil(";").commit(function(){var a=null,e=null;try{zb.setCurrentDatabase(d),c=zb.getCurrentDatabase(),e='Database "'+d+'" selected.'}catch(f){a=f}b(a,e)})},undo:b})},Bb.SHOW_DATABASES=function(a){return new N({name:"Show databases",execute:function(b){a.errorUntil(";").commit(function(){b(null,{cols:["Databases"],rows:m(zb.databases).map(g)})})},undo:function(a){a()}})},Bb.SHOW_TABLES=function(a){return new N({name:"Show tables",execute:function(b){var c,d=zb.getCurrentDatabase();a.is("FROM|IN")&&(a.forward(),a.someType(Tb,function(a){c=a[0],d=zb.databases[c]})),a.nextUntil(";").commit(function(){d?b(null,{cols:['Tables in database "'+d.name+'"'],rows:m(d.tables).map(g)}):c?b(new Zb('No such database "%s"',c),null):b(new Zb("No database selected"),null)})},undo:function(a){a()}})},Bb.SHOW_COLUMNS=function(a){function c(a){var b=[];return a.unsigned&&b.push("UNSIGNED"),a.zerofill&&b.push("ZEROFILL"),a.autoIncrement&&b.push("AUTO INCREMENT"),b.join(", ")}return new N({name:"Show columns",execute:function(d){var e,g;a.pick({"FROM|IN":function(){a.someType(Tb,function(a){g=a[0]})}}),a.is("FROM|IN")&&a.forward().someType(Tb,function(a){e=a[0]}),a.nextUntil(";"),a.commit(function(){var a,h=e?zb.databases[e]:zb.getCurrentDatabase();if(!h)return e?d(new Zb('No such database "%s"',e),null):d(new Zb("No database selected"),null);if(a=h.tables[g],!a)return d(new Zb('No such table "%s" in databse "%s"',g,h.name),null);var i={cols:["Field","Type","Null","Key","Default","Extra"],rows:[]};k(a.cols,function(a){var d=a.toJSON();i.rows.push([d.name,a.typeToSQL(),d.nullable?"YES":"NO",d.key,"string"==typeof d.defaultValue?f(d.defaultValue,"'"):d.defaultValue===b?"none":d.defaultValue,c(d)])}),d(null,i)})},undo:function(a){a()}})},Bb.CREATE_DATABASE=function(a){function b(a){c?zb.dropDatabase(c,!0,a):a()}var c;return new N({name:"Create Database",execute:function(b){var d=new tb;c=null,a.optional("IF NOT EXISTS",function(){d.ifNotExists(!0)}).someType(Tb,function(a){d.name(a[0])}).nextUntil(";").commit(function(){c=d.name(),d.execute(function(a){b(a,a?null:'Database "'+d.name()+'" created.')})})},undo:b})},Bb.CREATE_TABLE=function(a){function b(a){if(h){var b=zb.getCurrentDatabase();if(b){var c=b.tables[h];c&&a("Droping tables is not fully implemented yet!")}a()}else a()}function c(b){a.someType(Ub,function(a){b.params.push(a[0])}),a.pick({",":function(){c(b)},")":n})}function d(b){if(!b.name)try{a.someType(Tb,function(a){b.name=a[0]})}catch(c){}a.commaSeparatedBlock(function(a){b.columns.push(a[0])
}),a.walkOnConflictClause(function(a){b.onConflict=a})}function f(b){var c={};a.optional("CONSTRAINT",function(){a.someType(Tb,function(a){c.name=a[0]},"for the name of the constraint")}),a.pick({"KEY|INDEX":function(){c.type=rb.TYPE_INDEX,c.columns=[],d(c)},"PRIMARY KEY":function(){c.type=rb.TYPE_PRIMARY,c.columns=[],d(c)},UNIQUE:function(){c.type=rb.TYPE_UNIQUE,c.columns=[],d(c)},CHECK:function(){c.type="CHECK"},"FOREIGN KEY":function(){c.type="FOREIGN KEY",c.columns=[],a.commaSeparatedBlock(function(a){c.columns.push(a[0])})}}),b.addConstraint(c),a.optional({",":function(){f(b)}})}function g(b){var d={};a.someType(Tb,function(h){if(h[1]===Gb&&h[0].match(/^(CONSTRAINT|KEY|PRIMARY|UNIQUE|CHECK|FOREIGN)$/i)){if(!b.columns.length)throw new Yb("You have to define some table columns bore defining a table constraint.");a.back(),f(b)}else d.name=h[0],a.any(Wb,function(b){var e={name:b[0],params:[]};a.optional("(",function(){c(e)}),d.type=e,a.optional([{"NOT NULL":function(){d.nullable=!1},NULL:function(){d.nullable=!0}},{AUTO_INCREMENT:function(){d.autoIncrement=!0}},{KEY:function(){d.key="INDEX"},INDEX:function(){d.key="INDEX"},UNIQUE:function(){a.optional({KEY:n}),d.key="UNIQUE"},"PRIMARY KEY":function(){d.key="PRIMARY"}},{ZEROFILL:function(){d.zerofill=!0}},{UNSIGNED:function(){d.unsigned=!0}},{DEFAULT:function(){a.someType(Tb,function(a){d.defaultValue=a[0]})}}])},function(){throw new Yb('Expecting data type for column "%s" (%s).',d.name,e(Wb))}).pick({",":function(){b.columns.push(d),g(b)},")":function(){b.columns.push(d)}})})}var h;return new N({name:"Create Table",execute:function(b){var c=new ub;h=null,c.temporary("TEMPORARY"==a.lookBack(2)[0].toUpperCase()),a.optional("IF NOT EXISTS",function(){c.ifNotExists(!0)}).someType(Tb,function(a){c.name(a[0]),h=c.name()}).optional("(",function(){g(c)}).nextUntil(";").commit(function(){c.execute(function(a){b(a,a?null:'Table "'+c.name()+'" created')})})},undo:b})},Bb.DROP_DATABASE=function(a){return new N({name:"Drop Database",execute:function(b){var c={};a.optional("IF EXISTS",function(){c.ifExists=!0}).someType(Tb,function(a){c.name=a[0]},"for the database name").errorUntil(";").commit(function(){zb.dropDatabase(c.name,c.ifExists,function(a){b(a,a?null:'Database "'+c.name+'" deleted.')})})},undo:function(a){a("undo is not implemented for the DROP DATABASE queries")}})},Bb.DROP_TABLE=function(a){var b,c,d=!1;return new N({name:"Drop Table",execute:function(e){a.optional("IF EXISTS",function(){d=!0}).someType(Tb,function(a){b=a[0]}).optional(".",function(){a.someType(Tb,function(a){c=b,b=a[0]})}).optional("RESTRICT|CASCADE",function(){}).errorUntil(";").commit(function(){var a,f;if(c){if(a=zb.databases[c],!a)throw new Zb('No such database "%s"',c)}else if(a=Ab,!a)throw new Zb("No database selected.");return(f=a.tables[b])?void f.drop(function(b){return b?e(b,null):void e(null,'Table "'+a.name+"."+f.name+'" deleted.')}):d?e(null,'Table "'+a.name+"."+b+'" does not exist.'):e(new Zb('No such table "%s" in databse "%s"',b,a.name),null)})},undo:function(a){a(null,"undo is not implemented for the DROP TABLE queries")}})},Bb.INSERT=function(a){function b(c){c||(i=[]),a.someType(Tb,function(a){i.push(a[0])}).pick({",":function(){b(!0)},")":n})}function c(b){a.literalValue(function(a){var c=a[0];a[1]===Gb&&(c=c.toUpperCase(),"NULL"==c&&(c=null)),b.push(c)}).optional({",":function(){c(b)}})}function d(){a.pick({"(":function(){var b=[];c(b),a.pick({")":function(){var a=i.length,c=b.length;if(a!==c)throw new Yb("The number of inserted values (%s) must match the number of used columns (%s)",c,a);j.push(b)}})}}).optional({",":d})}var e,f,g,h,i,j=[];return new N({name:"Insert Query",execute:function(c){a.optional({OR:function(){a.pick({REPLACE:function(){h="REPLACE"},ROLLBACK:function(){h="ROLLBACK"},ABORT:function(){h="ABORT"},FAIL:function(){h="FAIL"},IGNORE:function(){h="IGNORE"}})}}).pick({INTO:n}).someType(Tb,function(a){f=a[0]}).optional(".",function(){a.someType(Tb,function(a){e=f,f=a[0]})}),g=p(f,e),i=m(g.cols),a.optional({"(":b}).pick({VALUES:d}).errorUntil(";").commit(function(){g.insert(i,j,function(a){c(a,a?null:j.length+" rows inserted")})})},undo:function(a){a("undo not implemented for INSERT queries!")}})},Bb.SELECT=function(a){function b(b){b=b||{};var d={database:null,table:null,field:null,isExpr:!1},e=n;b.allowAll&&(e+="|*"),b.allowIndexes&&(e+="|@"+Hb),b.includeAlias&&(d.alias=null);try{if(a.require(e),d.field=a.get(),a.forward(),a.is(".")&&(a.forward().require(e),d.table=d.field,d.field=a.get(),a.forward(),b.includeDB&&a.is(".")&&(a.forward().require(e),d.database=d.table,d.table=d.field,d.field=a.get(),a.forward())),t(d.field)){if(d.field=c(d.field),d.field<0)throw new Yb("Negative column index is not allowed.")}else if(!d.field)throw new Yb("Expecting a field name");if("*"==d.table)throw new Yb('You cannot use "*" as table name');if(t(d.table))throw new Yb("You cannot use number as table name");if("*"==d.database)throw new Yb('You cannot use "*" as database name');if(t(d.database))throw new Yb("You cannot use number as database name")}catch(f){var g=a.current()[2],h=a.current()[3];a.nextUntil(",|AS|FROM|WHERE|GROUP|ORDER|LIMIT|OFFSET|;",function(a){h=a[3]}),d.field=a._input.substring(g,h),d.isExpr=!0}return b.includeAlias&&a.is(n)&&(a.is("AS")?(a.forward(),a.someType(Tb,function(a){d.alias=a[0]})):a.is("FROM|WHERE|GROUP|ORDER|LIMIT|OFFSET")||(d.alias=a.current()[0],a.forward())),d}function d(){var b={database:null,table:null,alias:null};return a.someType(Tb,function(a){b.table=a[0]},"for table name").optional(".",function(){a.someType(Tb,function(a){b.database=b.table,b.table=a[0]},"for table name")}),a.is(n)&&(a.is("AS")?(a.forward(),a.someType(Tb,function(a){b.alias=a[0]},"for table alias")):a.is("WHERE|GROUP|ORDER|LIMIT|OFFSET")||(b.alias=a.current()[0],a.forward())),b}function e(c){var d=b({includeAlias:!0,allowAll:!0,allowIndexes:!1,includeDB:!0});c.push(d),a.is(",")&&(a.forward(),e(c))}function f(b){var c=d();b.push(c),a.is(",")&&(a.forward(),f(b))}function g(){var b=[],c={expression:[],direction:"ASC"};return a.nextUntil("ASC|DESC|,|LIMIT|OFFSET|;",function(a){c.expression.push(a[0])}),c.expression=c.expression.join(" "),a.is("ASC|DESC")&&(c.direction=a.get().toUpperCase(),a.forward()),b.push(c),a.is(",")&&(a.forward(),b=b.concat(g())),b}function h(){var b=[];return a.is("ORDER BY")&&(a.forward(2),b=g()),b}function i(){var b=0,d=0;if(a.is("LIMIT")){if(a.forward(),!a.is("@"+Hb))throw new Yb("Expecting a number for the LIMIT clause");if(b=c(a.get()),a.forward(),a.is(",")){if(!a.forward().is("@"+Hb))throw new Yb("Expecting a number for the offset part of the LIMIT clause");d=c(a.get()),a.forward()}}if(a.is("OFFSET")){if(a.forward(),!a.is("@"+Hb))throw new Yb("Expecting a number for the OFFSET clause");d=c(a.get()),a.forward()}return{limit:b,offset:d}}function j(){var b=0,c=0;return a.is("WHERE")&&(a.forward(),b=a.current()[2],c=b,a.nextUntil("GROUP|ORDER|LIMIT|OFFSET|;"),c=a.current()[2]),a._input.substring(b,c)}function k(a){var b,c=a.tables.length,d={};for(b=0;c>b;b++)d[b]=d[a.tables[b].table]=p(a.tables[b].table,a.tables[b].database),a.tables[b].alias&&(d[a.tables[b].alias]=d[b]);return d}function l(){var a,b,c,d,e,f,g={};for(a in zb.databases){f=zb.databases[a],g[a]={};for(b in f.tables){d=f.tables[b],g[a][b]={};for(c in d.cols)e=d.cols[c],g[a][b][c]=e}}return g}function m(a){function b(a,b){var c={database:a.database,table:a.table,colIndex:b,value:null,name:a.field,alias:a.alias,isExpr:a.isExpr};a.table&&(e=p(a.table.table,a.table.database),y.hasOwnProperty(e.name)||(y[e.name]={name:e.name}),c.table=y[e.name],x.hasOwnProperty(e._db.name)||(x[e._db.name]={}),y[e.name].database=x[e._db.name],x[e._db.name][e.name]=c.table,c.database=x[e._db.name]),r[a.field]=null,a.alias&&(r[a.alias]=null),z[b]=z[a.field]=c,a.alias&&(z[a.alias]=c),t.push(c.alias||c.name)}var c,d,e,f,g,h,i,j,m,n,o,q,r=l(),s=[],t=[],u=k(a),v=a.tables.length,w=a.fields.length,x={},y={},z={};for(m=0,j=0;w>j;j++)if(i=a.fields[j],"*"==i.field)if(i.table){e=p(i.table,i.database);for(d in e.cols)b({field:d,alias:null,table:{table:e.name,database:e._db.name},database:e._db.name,isExpr:!1},m++)}else for(o=0;v>o;o++){e=u[o];for(d in e.cols)b({field:d,alias:null,table:{table:e.name,database:e._db.name},database:e._db.name,isExpr:!1},m++)}else{if(!i.isExpr&&!i.table){if(1!==v)throw new Yb('The column "%s" needs to have it\'s table specified',i.field);i.table=a.tables[0]}b(i,m++)}z.__length__=m;var A,B=[];for(j=0;v>j;j++){A=[],e=u[j];for(f in e.rows)A.push(e.rows[f].toJSON());B.push(A)}for(j=0;w>j;j++)i=a.fields[j],i.isExpr&&(h={},h[i.alias||i.field]=i.field.replace(/^\s*\((.*?)(\)\s*$)/,"$1"),B.push([h]));s=F(B),a.orderBy&&s.sort(function(b,c){var d,e,f,g,h,i=0;for(g=0;g<a.orderBy.length&&(h=a.orderBy[g],d=h.expression,e=b[d],f=c[d],e>f?i+="ASC"==h.direction?1:-1:f>e&&(i+="ASC"==h.direction?-1:1),0===i);g++);return i});var C=a.bounds.limit,D=a.bounds.offset,G=s.length;for(0>D&&(D=G+D),n=s.length,j=0;n>j;j++){g=s[j];for(c in g)q=z[c],q&&q.isExpr&&(g[c]=E(g[c],g))}var H=[];for(j=0;n>j;j++)if(!(D>j||C&&j>=D+C||(g=s[j],a.where&&!E(a.where,g)))){for(c in g)q=z[c],q?q.alias&&q.alias!==c&&delete g[c]:delete g[c];H.push(g)}return{cols:t,rows:H}}var n=["@"+Gb,"@"+Jb,"@"+Kb,"@"+Lb].join("|");return new N({name:"SELECT Query",execute:function(b){var c={fields:[],tables:[]};e(c.fields),a.optional({FROM:function(){f(c.tables)}}),c.where=j(),c.orderBy=h(),c.bounds=i(),a.errorUntil(";").commit(function(){var a=m(c);b(null,{cols:a.cols,rows:a.rows})})},undo:function(a){a()}})},Bb.DELETE=function(a){return new N({name:"Delete Query",execute:function(b){var c,d,e=0,f=0,g="",h=["@"+Gb,"@"+Jb,"@"+Kb,"@"+Lb].join("|");if(a.require("FROM"),!a.forward().is(h))throw new Yb('Expecting an identifier for table name before "%s"',a.get());if(c=a.get(),a.forward().is(".")){if(!a.forward().is(h))throw new Yb("Expecting an identifier for table name after %s.",c);d=c,c=a.get(),a.forward()}a.is("WHERE")?(a.forward(),e=a.current()[2],f=e,a.nextUntil(";"),f=a.current()[2],g=a._input.substring(e,f)):a.errorUntil(";"),a.commit(function(){var a,e,f=d?zb.getDatabase(d):zb.getCurrentDatabase(),h=[],i=0;if(!f)throw d?new Zb("No such database '%s'",d):new Zb("No database selected");a=f.getTable(c),e=a.rows,k(e,function(a){(!g||E(g,a.toJSON(!0)))&&(i=h.push(a))}),i?a.deleteRows(h,function(a){b(a,a?null:i+" rows deleted")}):b(null,i+" rows deleted")})},undo:function(a){Eb.debug&&console.warn("undo not implemented for DELETE queries!"),a()}})},Bb.UPDATE=function(a){function b(a){var b="ABORT";return a.is("OR")&&(a.forward().require("ROLLBACK|ABORT|REPLACE|FAIL|IGNORE"),b=a.get().toUpperCase(),a.forward()),b}function c(a){var b,c,d;if(!a.is(f))throw new Yb('Expecting a table identifier before "%s"',a.get());if(b=a.get(),a.forward().is(".")){if(!a.forward().is(f))throw new Yb("Expecting an identifier for table name after %s.",b);c=b,b=a.get(),a.forward()}if(d=c?zb.getDatabase(c):zb.getCurrentDatabase(),!d)throw c?new Zb("No such database '%s'",c):new Zb("No database selected");return d.getTable(b)}function d(a){var b,c,d="";return a.is("WHERE")&&(a.forward(),b=a.current()[2],c=b,a.nextUntil(";"),c=a.current()[2],d=a._input.substring(b,c)),d}function e(a){function b(){var d,e,g,h;if(!a.is(f))throw new Yb('Expecting a column identifier before "%s"',a.get());d=a.get(),a.forward(),a.require("="),g=a.current()[3],a.forward(),h=g,a.nextUntil(",|WHERE|;"),h=a.current()[2],e=i(a._input.substring(g,h)),c[d]=e,a.is(",")&&(a.forward(),b())}var c={};return a.require("SET"),a.forward(),b(),c}var f=["@"+Gb,"@"+Jb,"@"+Kb,"@"+Lb].join("|");return new N({name:"Update Table",execute:function(f){var g=b(a),h=c(a),i=e(a),j=d(a);a.errorUntil(";").commit(function(){h.update(i,g,j,function(){f(null,"DONE")},function(a){f(a,null)})})},undo:function(a){Eb.debug&&console.warn("undo is not implemented for UPDATE queries yet!"),a()}})},Bb.BEGIN=function(a){return new N({name:"Begin transaction",execute:function(b){var c="DEFERRED";a.is("DEFERRED|IMEDDIATE|EXCLUSIVE")&&(c=a.get().toUpperCase(),a.forward()),a.is("TRANSACTION")&&a.forward(),a.errorUntil(";"),a.commit(function(){zb.beginTransaction({type:c}),b(null,"Transaction created")})},undo:function(a){zb.rollbackTransaction(a)}})},Bb.COMMIT=function(a){return new N({name:"Commit transaction",execute:function(b){a.is("TRANSACTION")&&a.forward(),a.errorUntil(";"),a.commit(function(){zb.commitTransaction(),b()})},undo:function(a){zb.rollbackTransaction(a)}})},Bb.ROLLBACK=function(a){return new N({name:"Rollback transaction",execute:function(b){a.is("TRANSACTION")&&a.forward(),a.errorUntil(";"),a.commit(function(){zb.rollbackTransaction(),b()})},undo:function(a){zb.commitTransaction(),a()}})},Bb.SOURCE=function(a){return new N({name:"SOURCE Command",execute:function(b){var c,e,f,g=a.current()[2],h=["@"+Jb,"@"+Kb,"@"+Lb].join("|");a.is(h)?(f=a.get().trim(),a.forward().errorUntil(";")):(g=a.current()[2],a.nextUntil(";"),e=a.current()[2],f=a._input.substring(g,e).trim()),a.commit(function(){f&&(c=new XMLHttpRequest,c.open("GET",f,!0),c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status||304==c.status){var a=P(c.responseText),e=a.length;S(a,function(a,c){c===e-1&&b(null,d('%s queries executed successfuly from file "%s"',e,f))},function(c,d){b(c+" (query: "+a[d].sql+")",null)})}else b(c.statusText,null)},c.send(null))})},undo:function(a){Eb.debug&&console.warn("The SOURCE command cannot be undone!"),a()}})},O.prototype=[];var ac=function(){var a={},b={};return{getEngine:function(c){return b[c]||(b[c]=new a[c]),b[c]},registerEngine:function(b,c){if(a[b])throw new Error('Storage engine "'+b+'" is already registered.');a[b]=c},getEnginePrototype:function(){return{set:function(a,b,c){c("Failed to save - not implemented.")},get:function(a,b){b("Failed to read - not implemented.")},unset:function(a,b){b("Failed to delete - not implemented.")},setMany:function(a,b){b("Failed to save - not implemented.")},getMany:function(a,b){b("Failed to read - not implemented.")},unsetMany:function(a,b){b("Failed to delete - not implemented.")}}}}}();T.prototype=ac.getEnginePrototype(),T.prototype.constructor=T,ac.registerEngine("LocalStorage",T),U.prototype=ac.getEnginePrototype(),U.prototype.constructor=U,ac.registerEngine("MemoryStorage",U),V.prototype=ac.getEnginePrototype(),V.prototype.constructor=V,ac.registerEngine("FileSystemStorage",V),W.prototype={storage:ac.getEngine("LocalStorage"),toJSON:function(){throw"Please implement the 'toJSON' method to return the JSON representation of the instance"},getStorageKey:function(){throw"Please implement the 'getStorageKey' method to return the storage key"},read:function(a){this.storage.get(this.getStorageKey(),function(b,c){if(b)return a(b,null);try{c=JSON.parse(c)}catch(d){b=d}a(b,c)})},write:function(a,b){this.storage.set(this.getStorageKey(),JSON.stringify(a),b)},drop:function(a){return this.storage.unset(this.getStorageKey(),a)},save:function(a){this.write(this.toJSON(),a)},load:function(a){this.read(a)}},X.prototype=new W,X.prototype.constructor=X,X.prototype.getStorageKey=function(){return Cb},X.prototype.toJSON=function(){var a={databases:{}};for(var b in this.databases)a.databases[b]=this.databases[b].getStorageKey();return a},X.prototype.load=function(a){function b(a){d.add(M.createTask({name:"Load Database '"+a+"'",execute:function(b){var d=new Y(a);c.databases[d.name]=d,d.load(b)},undo:function(a){a(null,c.databases[db.name])}}))}var c=this,d=new M({name:"Load Server"}),e=B(a);return d.one("complete",function(){c.loaded=!0,_b.dispatch("load:server",c),e(null,c)}),d.one("rollback",function(a,b){e(b,c)}),d.add(M.createTask({name:"Load Server",execute:function(a){c.read(function(d,e){if(d)return a(d,c);if(c.databases={},!e||!e.databases)return a(null,c);for(var f in e.databases)e.databases.hasOwnProperty(f)&&b(f);return a(null,c)})}})),_b.dispatch("loadstart:server",c),d.start(),c},X.prototype.save=function(a){var b=this,c=B(a);return _b.dispatch("savestart:server",b),W.prototype.save.call(b,function(a){return a?c(a,null):(_b.dispatch("save:server",b),void c(null,b))}),b},X.prototype.createDatabase=function(a,b,c){var d=B(c),e=this;if("string"!=typeof a)return d(new Zb("Invalid database name"),null);if(!a)return d(new Zb("No database name"),null);if(this.databases.hasOwnProperty(a))return b?d(null,this.databases[a]):d(new Zb('Database "'+a+'" already exists'),null);var f=new Y(a);f.save(function(b){return b?d(b,f):(e.databases[a]=f,void f.save(function(a){return a?d(a,f):void d(null,f)}))})},X.prototype.dropDatabase=function(a,b,c){var d=B(c),e=this;e.databases.hasOwnProperty(a)?e.databases[a].drop(function(b,c){return b?d(b,e):(e.currentDatabase===c&&(e.currentDatabase=null),delete e.databases[a],void e.save(function(a){d(a,e)}))}):d(b?null:new Zb('Database "'+a+'" does not exist'),e)},X.prototype.getDatabase=function(a){return this.databases[i(a)]},X.prototype.setCurrentDatabase=function(a){var b=i(a);if(!this.databases.hasOwnProperty(b))throw new Zb('No such database "%s".',b);return Ab=this.currentDatabase=this.databases[b],this},X.prototype.getCurrentDatabase=function(){return this.currentDatabase},Y.prototype=new W,Y.prototype.constructor=Y,Y.prototype.toJSON=function(){var a,b={name:this.name,tables:{}};for(a in this.tables)b.tables[a]=[Cb,this.name,a].join(".");return b},Y.prototype.getStorageKey=function(){return Cb+"."+this.name},Y.prototype.drop=function(a){function b(a){f.add(M.createTask({name:'Drop Table "'+a.name+'"',execute:function(b){delete e.tables[a.name],a.drop(b)},undo:function(b){e.tables[a.name]=a,b()}}))}var c,d=B(a),e=this,f=new M({name:"Drop Database"});f.one("complete",function(){d(null,e)}),f.one("rollback",function(a){d(a,e)});for(c in e.tables)b(e.tables[c]);f.add(M.createTask({name:'Drop Database "'+e.name+'"',execute:function(a){delete zb.databases[e.name],W.prototype.drop.call(e,a)},undo:function(a){zb.databases[e.name]=e,a()}})),f.start()},Y.prototype.load=function(a){function b(a){d.add(M.createTask({name:'Load Table "'+a.name+'"',execute:function(b){a.load(b)},undo:function(b){b(null,a)}}))}var c=this,d=new M({name:"Load Database"}),e=B(a);return _b.dispatch("loadstart:database",c),d.one("complete",function(){_b.dispatch("load:database",c),e(null)}),d.one("rollback",function(a,b){e(b)}),d.add(M.createTask({name:"Create DB Tables",execute:function(a){c.read(function(d,e){if(d)return a(d,c);if(c.tables={},!e||!e.tables)return a(null,c);for(var f in e.tables){var g=new Z(f,c);c.tables[g.name]=g,b(g)}return a(null,c)})},undo:function(a){console.warn("Undoing Create DB Tables task"),a()}})),d.start(),c},Y.prototype.save=function(a){var b=this,c=B(a);return _b.dispatch("savestart:database",b),W.prototype.save.call(b,function(a){return a?c(a,null):void zb.save(function(a){return a?c(a,null):(_b.dispatch("save:database",b),c(null,b))})}),b},Y.prototype.createTable=function(a,b,c,d){var e,f,g=B(d),h=this;if(h.tables.hasOwnProperty(a)&&!c)return g(new Zb('Table "%s" already exists',a),null);for(e=new Z(a,this),f=0;f<b.length;f++)e.addColumn(b[f]);e.save(function(b){return b?g(b,null):(h.tables[a]=e,void h.save(function(a){return a?g(a,null):void g(null,e)}))})},Y.prototype.getTable=function(a){var b=this.tables[a];if(!b)throw new Zb('No such table "%s" in database "%s"',a,this.name);return b},Z.prototype=new W,Z.prototype.constructor=Z,Z.prototype.toJSON=function(){var a={name:this.name,columns:{},rows:{},keys:{}};for(var b in this.cols)a.columns[b]=this.cols[b].toJSON();for(b in this.rows)a.rows[b]=this.rows[b].getStorageKey();for(b in this.keys)a.keys[b]=this.keys[b].toJSON();return a},Z.prototype.getStorageKey=function(){return[Cb,this._db.name,this.name].join(".")},Z.prototype.addConstraint=function(a){if(a.type==rb.TYPE_INDEX||a.type==rb.TYPE_UNIQUE||a.type==rb.TYPE_PRIMARY){var b=rb.fromJSON(a,this);this.keys[b.name]=b;for(var c=0,d=a.columns.length;d>c;c++)this.cols[a.columns[c]].setKey(a.type)}},Z.prototype.addColumn=function(a){var b=$.create(a);switch(b.key){case"PRIMARY":this.keys[b.name]=new rb(this,[b.name],rb.TYPE_PRIMARY,b.name);break;case"UNIQUE":this.keys[b.name]=new rb(this,[b.name],rb.TYPE_UNIQUE,b.name);break;case"KEY":case"INDEX":this.keys[b.name]=new rb(this,[b.name],rb.TYPE_INDEX,b.name)}return this.cols[a.name]=b,this._col_seq.push(a.name),b.key,b},Z.prototype.save=function(a){var b=this._db,c=this,d=B(a);return _b.dispatch("savestart:table",c),W.prototype.save.call(this,function(a){return a?d(a):void b.save(function(a){return a?d(a):(_b.dispatch("save:table",c),void d(null,c))})}),this},Z.prototype.load=function(a){var b=this,c=B(a);Db.events.dispatch("loadstart:table",b),b.read(function(a,d){function e(a,d){if(a)return g||(g=!0,c(a,null)),!1;for(var e in b.keys)b.keys[e].beforeInsert(d);b._ai=Math.max(b._ai,d.id)+1,b.rows[d.id]=d,b._length++,b._row_seq.push(d.id),0===--h&&(Db.events.dispatch("load:table",b),c(null,b))}var f,g,h=0;if(d){b.cols={},b.rows={},b.keys={};for(f in d.columns)b.addColumn(d.columns[f]);if(d.keys){b.keys={},b.primaryKey=null;for(f in d.keys)b.keys[f]=rb.fromJSON(d.keys[f],b)}for(var i in d.rows)b.rows[i]=new qb(b,i),h++;if(h)for(i in b.rows)b.rows[i].load(e);else Db.events.dispatch("load:table",b),c(null,b)}})},Z.prototype.insert=function(a,b,c){function d(c){var d;g.add(M.createTask({name:"Insert row "+c,execute:function(f){var g,i=new qb(e,e._ai);for(g=0;h>g;g++)i.setCellValue(a[g],b[c][g]);for(g in e.keys)e.keys[g].beforeInsert(i);d=e._ai++,e.rows[d]=i,e._length++,e._row_seq.push(d),i.save(f)},undo:function(a){return d?e.rows[d].drop(a):void a()}}))}var e=this,f=B(c),g=new M({name:"Insert into table "+e.name}),h=a.length,i=b.length;g.one("complete",function(){f(null,e)}),g.one("rollback",function(a,b){f(b,null)}),g.add(M.createTask({name:"insert",execute:function(a){for(var b=0;i>b;b++)d(b);a()},undo:function(a){a()}})),g.add(M.createTask({name:"Save table after inserts",execute:function(a){e.save(a)}})),g.start()},Z.prototype.update=function(a,b,c,e,f){function g(a){if(l)return!0;if(l=!0,a&&a instanceof $b)switch(b){case"ROLLBACK":j.setOption("reqursiveRollback",!0),j.one("rollback",function(){f&&f(a),console.info("Update lolled back!")}),j.rollback();break;case"FAIL":f&&f(a);break;case"IGNORE":j.next();break;case"REPLACE":break;default:j.setOption("reqursiveRollback",!1),j.one("rollback",function(){f&&f(a),console.info("Update lolled back!")}),j.rollback()}else f&&f(a)}function h(b,c){var d=b.toJSON(),e=M.createTask({name:"Update row "+b.getStorageKey(),execute:function(d){var e;try{for(e in a)c[e]=E(a[e],c);if(!Db.events.dispatch("beforeupdate:row",b))return d(null);for(var f in i.keys)i.keys[f].beforeUpdate(b,c);for(e in a)b.setCellValue(e,c[e]);Db.events.dispatch("update:row",b),d(null)}catch(g){d(g)}},undo:function(a){for(var c in d)b.setCellValue(c,d[c]);a()}});j.add(e)}if(!Db.events.dispatch("beforeupdate:table",this))return f(null,d('The UPDATE procedure of table "%s" was canceled by a "beforeupdate:table" event listener',this.getStorageKey()));var i=this,j=new M({name:"Update "+i.name+" transaction",autoRollback:!1,onError:g,onComplete:function(){i.save(function(a){return a?f(a):(Db.events.dispatch("update:table",i),void e())})}}),l=!1;k(i.rows,function(a){var b=a.toJSON();return c&&!E(c,b)?!0:void h(a,b)}),j.start()},Z.prototype.drop=function(a){var b,c=this,e=c.getStorageKey(),f=[],g=B(a);if(!_b.dispatch("before_delete:table",c))return g(d('"%s" event  canceled',"before_delete:table"),c);for(b in c.rows)f.push(e+"."+b);c.storage.unsetMany(f,function(a){return a?g(a,c):void W.prototype.drop.call(c,function(a){return a?g(a,c):(delete c._db.tables[c.name],void c._db.save(function(a){return a?g(a,c):(_b.dispatch("after_delete:table",c),void g(null,c))}))})})},Z.prototype.deleteRows=function(a,b){var c=this,d=[],e=B(b);a=g(a),k(a,function(a){d.push(a.getStorageKey())}),c.storage.unsetMany(d,function(b){return b?e(b):(k(a,function(a){for(var b in c.keys)c.keys[b].beforeDelete(a);var d=u(c._row_seq,a.id,rb.compare);d>=0&&(delete c.rows[a.id],c._row_seq.splice(d,1))}),d=null,void c.save(function(a){e(a)}))})};var bc={BIT:ab,TINYINT:eb,SMALLINT:fb,MEDIUMINT:gb,INT:bb,INTEGER:cb,BIGINT:hb,DOUBLE:kb,FLOAT:lb,DECIMAL:ib,NUMERIC:jb,CHAR:ob,VARCHAR:nb,ENUM:pb};$.constructors=bc,$.prototype={key:b,name:null,length:-1,type:null,nullable:!1,setName:function(a){if(a&&(a=i(a)))return this.name=a,this;throw new Zb('Invalid column name "%s".',a)},setKey:function(a){var c=String(a).toUpperCase();this.key=a===rb.TYPE_INDEX?"INDEX":"INDEX"==c||"KEY"==c?c:a===rb.TYPE_UNIQUE||"UNIQUE"==c?"UNIQUE":a===rb.TYPE_PRIMARY||"PRIMARY"==c?"PRIMARY":b},setDefaultValue:function(a){this.defaultValue=a===b?a:this.set(a)},init:function(a){return this.setName(a.name),this.setKey(a.key),this.setDefaultValue(a.defaultValue),this.nullable=!!a.nullable,this},toJSON:function(){var a={name:this.name,key:this.key,defaultValue:this.defaultValue,nullable:!!this.nullable,type:{name:this.type,params:this.typeParams.slice()}};return a},typeToSQL:function(){var a=[this.type];return this.typeParams.length&&a.push("(",this.typeParams.join(", "),")"),a.join("")}},$.create=function(a){var b,c=a.type.name.toUpperCase(),d=bc[c];if(!d)throw new Zb('Unknown data type "%s".',a.type.name);return b=new d,b.init(a),b},_.prototype=new $,_.prototype.constructor=_,_.prototype.unsigned=!1,_.prototype.zerofill=!1,_.prototype.autoIncrement=!1,_.prototype.minUnsigned=0,_.prototype.minSigned=-1,_.prototype.maxUnsigned=2,_.prototype.maxSigned=1,_.prototype.max=1,_.prototype.min=-1,_.prototype.init=function(a){this.setUnsigned(a.unsigned),r(a.type.params)&&a.type.params.length>0&&(this.setLength(a.type.params[0]),this.typeParams=[this.length]),this.setAutoIncrement(a.autoIncrement),this.zerofill=!!a.zerofill,$.prototype.init.call(this,a)},_.prototype.setAutoIncrement=function(a){this.autoIncrement=!!a},_.prototype.setUnsigned=function(a){this.unsigned=!!a,this.min=this.unsigned?this.minUnsigned:this.minSigned,this.max=this.unsigned?this.maxUnsigned:this.maxSigned},_.prototype.setLength=function(a){var b=String(this.max).length;if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>b)throw new Zb('Invalid length for column "%s". The length must be between 1 and %s inclusive.',this.name,b);this.length=a},_.prototype.toJSON=function(){var a={name:this.name,unsigned:this.unsigned,zerofill:this.zerofill,key:this.key,defaultValue:this.defaultValue===b?this.defaultValue:String(this.defaultValue),autoIncrement:this.autoIncrement,nullable:this.nullable,type:{name:this.type,params:this.typeParams.slice()}};return a},_.prototype.toSQL=function(){var a=[f(this.name),this.typeToSQL(),this.nullable?"NULL":"NOT NULL"];return this.unsigned&&a.push("UNSIGNED"),this.zerofill&&a.push("ZEROFILL"),this.autoIncrement&&a.push("AUTO_INCREMENT"),"PRIMARY"==this.key?a.push("PRIMARY KEY"):"UNIQUE"==this.key?a.push("UNIQUE"):"INDEX"==this.key&&a.push("KEY"),this.defaultValue!==b&&a.push("DEFAULT",f(this.defaultValue,"'")),a.join(" ")},ab.prototype=new _,ab.prototype.constructor=ab,ab.prototype.type="BIT",ab.prototype.init=function(a){if(_.prototype.init.call(this,a),r(a.type.params)&&a.type.params.length>0){if(1!==a.type.params.length)throw new Zb('Invalid data type declaration for column "%s". The syntax is "INT[(length)]".',a.name);this.setLength(a.type.params[0]),this.typeParams=[this.length]}},ab.prototype.setLength=function(a){if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>64)throw new Zb('Invalid length for column "%s". The length must be between 1 and 64 inclusive.',this.name);this.length=a},ab.prototype.set=function(a){var b,c=String(a),d=c.length;if(d>this.length)throw new Zb('The data ("%s") is too long for the field "%s". It may contain up to %s bits',c,this.name,this.length);if(b=parseInt(c,2),isNaN(b)||!isFinite(b))throw new Zb('Invalid bit field value for column "%s". Expecting up to %s bits as binary number literal',this.name,this.length);for(;d++<this.length;)c="0"+c;return c},bb.prototype=new _,bb.prototype.constructor=bb,bb.prototype.type="INT",bb.prototype.minUnsigned=0,bb.prototype.minSigned=-2147483648,bb.prototype.maxUnsigned=4294967295,bb.prototype.maxSigned=2147483647,bb.prototype.init=function(a){if(_.prototype.init.call(this,a),r(a.type.params)&&a.type.params.length>0){if(1!==a.type.params.length)throw new Zb('Invalid data type declaration for column "%s". The syntax is "INT[(length)]".',a.name);this.setLength(a.type.params[0]),this.typeParams=[this.length]}},bb.prototype.setLength=function(a){var b=String(this.minSigned).length;if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>b)throw new Zb('Invalid length for column "%s". The length must be between 1 and %s inclusive.',this.name,b);this.length=a},bb.prototype.set=function(a){if(null===a){if(this.nullable||this.autoIncrement)return a;throw new Zb('Column "%s" cannot be NULL.',this.name)}var b=parseInt(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new Zb('Invalid value for column "%s". Expecting an integer between %s and %s.',this.name,this.min,this.max);return b},cb.prototype=new bb,cb.prototype.constructor=cb,cb.prototype.type="INTEGER",eb.prototype=new bb,eb.prototype.constructor=eb,eb.prototype.type="TINYINT",eb.prototype.minUnsigned=0,eb.prototype.minSigned=-128,eb.prototype.maxUnsigned=255,eb.prototype.maxSigned=127,fb.prototype=new bb,fb.prototype.constructor=fb,fb.prototype.type="SMALLINT",fb.prototype.minUnsigned=0,fb.prototype.minSigned=-32768,fb.prototype.maxUnsigned=65535,fb.prototype.maxSigned=32767,gb.prototype=new bb,gb.prototype.constructor=gb,gb.prototype.type="MEDIUMINT",gb.prototype.minUnsigned=0,gb.prototype.minSigned=-8388608,gb.prototype.maxUnsigned=16777215,gb.prototype.maxSigned=8388607,hb.prototype=new bb,hb.prototype.constructor=hb,hb.prototype.type="BIGINT",hb.prototype.minUnsigned=0,hb.prototype.minSigned=-0x8000000000000000,hb.prototype.maxUnsigned=0x10000000000000000,hb.prototype.maxSigned=0x8000000000000000,ib.prototype=new _,ib.prototype.constructor=ib,ib.prototype.type="DECIMAL",ib.prototype.length=10,ib.prototype.decimals=0,ib.prototype.minUnsigned=bb.prototype.minUnsigned,ib.prototype.minSigned=bb.prototype.minSigned,ib.prototype.maxUnsigned=bb.prototype.maxUnsigned,ib.prototype.maxSigned=bb.prototype.maxSigned,ib.prototype.min=bb.prototype.minUnsigned,ib.prototype.max=bb.prototype.maxUnsigned,ib.prototype.init=function(a){if(_.prototype.init.call(this,a),r(a.type.params)){if(1!==a.type.params.length)throw new Zb('Invalid data type declaration for column "%s". The syntax is "%s[(length)]".',a.name,this.type.toUpperCase());this.setLength(a.type.params[0]),this.typeParams=[this.length]}this.setDefaultValue(a.defaultValue)},ib.prototype.set=function(a){var b=parseFloat(a);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new Zb('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);return b=Number(a).toPrecision(this.length),Number(b).toFixed(this.decimals)},jb.prototype=new ib,jb.prototype.constructor=jb,jb.prototype.type="NUMERIC",kb.prototype=new _,kb.prototype.constructor=kb,kb.prototype.type="DOUBLE",kb.prototype.length=10,kb.prototype.decimals=2,kb.prototype.minUnsigned=bb.prototype.minUnsigned,kb.prototype.minSigned=bb.prototype.minSigned,kb.prototype.maxUnsigned=bb.prototype.maxUnsigned,kb.prototype.maxSigned=bb.prototype.maxSigned,kb.prototype.init=function(a){if(_.prototype.init.call(this,a),r(a.type.params)){if(1!==a.type.params.length)throw new Zb('Invalid data type declaration for column "%s". The syntax is "%s[(length)]".',a.name,this.type.toUpperCase());this.setLength(a.type.params[0]),this.typeParams=[this.length]}},kb.prototype.set=function(a){var b=parseFloat(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new Zb('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);b=Number(a).toPrecision(this.length);var c=Math.pow(10,this.decimals);return Math.round(b*c)/c},lb.prototype=new _,lb.prototype.constructor=lb,lb.prototype.type="FLOAT",lb.prototype.length=10,lb.prototype.decimals=2,lb.prototype.minUnsigned=bb.prototype.minUnsigned,lb.prototype.minSigned=bb.prototype.minSigned,lb.prototype.maxUnsigned=bb.prototype.maxUnsigned,lb.prototype.maxSigned=bb.prototype.maxSigned,lb.prototype.init=function(a){if(_.prototype.init.call(this,a),this.typeParams=[this.length],r(a.type.params)){if(a.type.params.length>2)throw new Zb('Invalid data type declaration for column "%s". The syntax is "%s[(length[, decimals])]".',a.name,this.type.toUpperCase());
this.typeParams=[],a.type.params.length>0&&(this.setLength(a.type.params[0]),this.typeParams[0]=this.length),a.type.params.length>1&&(this.decimals=c(a.type.params[1]),this.typeParams[1]=this.decimals)}},lb.prototype.set=function(a){var b=parseFloat(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new Zb('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);b=Number(a).toPrecision(this.length);var c=Math.pow(10,this.decimals);return Math.round(b*c)/c},mb.prototype=new $,mb.prototype.constructor=mb,mb.prototype.type="STRING",mb.prototype.length=-1,mb.prototype.maxLength=Number.MAX_VALUE,mb.prototype.init=function(a){r(a.type.params)&&a.type.params.length>0&&"-1"!=String(a.type.params[0])&&(this.setLength(a.type.params[0]),this.typeParams=[this.length]),$.prototype.init.call(this,a)},mb.prototype.setLength=function(a){if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||0>a)throw new Zb('Invalid length for column "%s". The length must be a positive integer.',this.name);this.length=Math.min(a,this.maxLength)},mb.prototype.set=function(a){var b,c=String(a);if(-1==this.length)return c;if(b=c.length,b>this.length)throw new Zb('Truncated value for column "%s".',this.name);return c},mb.prototype.toSQL=function(){var a=[f(this.name),this.typeToSQL(),this.nullable?"NULL":"NOT NULL"];return"PRIMARY"==this.key?a.push("PRIMARY KEY"):"UNIQUE"==this.key?a.push("UNIQUE"):"INDEX"==this.key&&a.push("KEY"),this.defaultValue!==b&&a.push("DEFAULT",f(this.defaultValue,"'")),a.join(" ")},nb.prototype=new mb,nb.prototype.constructor=nb,nb.prototype.type="VARCHAR",nb.prototype.length=-1,nb.prototype.maxLength=65535,ob.prototype=new mb,ob.prototype.constructor=ob,ob.prototype.type="CHAR",ob.prototype.length=-1,ob.prototype.maxLength=65535,pb.prototype=new mb,pb.prototype.constructor=pb,pb.prototype.type="ENUM",pb.prototype.setLength=function(){},pb.prototype.init=function(a){if(!r(a.type.params)||a.type.params.length<1)throw new Zb('The "%s" column type requires at least one option.',this.type);this.typeParams=a.type.params.slice(),$.prototype.init.call(this,a)},pb.prototype.set=function(a){var b=String(a);if(-1==this.typeParams.indexOf(b))throw new Zb('The value for column "%s" must be %s.',this.name,e(this.optionSet));return b},pb.prototype.typeToSQL=function(){var a=[this.type];if(this.typeParams.length){a.push("(");for(var b=0,c=this.typeParams.length;c>b;b++)a.push(f(this.typeParams[b],"'")),c-1>b&&a.push(", ");a.push(")")}return a.join("")},qb.prototype=new W,qb.prototype.constructor=qb,qb.prototype.getStorageKey=function(){return[Cb,this.table._db.name,this.table.name,this.id].join(".")},qb.prototype.load=function(a){var b=this,c=B(a);_b.dispatch("loadstart:row",b),b.read(function(a,d){if(a)return c(a,null);if(d)for(var e=0;e<b.length;e++)b._data[e]=b.table.cols[b.table._col_seq[e]].set(d[e]);Db.events.dispatch("load:row",b),c(null,b)})},qb.prototype.save=function(a){var b=this,c=B(a);_b.dispatch("savestart:row",b),b.write(this._data,function(a){return a?c(a,null):(_b.dispatch("save:row",b),void c(null,b))})},qb.prototype.setTable=function(a){var c,d;w(a,Z),this.length=0,this._cellsByName={},this.table=a,this._data=[];for(c in a.cols)d=a.cols[c],this._cellsByName[c]=this.length,this.setCellValue(this.length++,d.defaultValue===b?null:d.defaultValue);return this},qb.prototype.getCell=function(a){return y(a,this._cellsByName,'No such field "'+a+'".'),this._data[this._cellsByName[a]]},qb.prototype.getCellAt=function(a){return x(a,this._data,'No field at index "'+a+'".'),this._data[a]},qb.prototype.setCellValue=function(a,b){var c;return t(a)?(c=this.table.cols[this.table._col_seq[a]],b=c.set(b),null===b&&c.autoIncrement&&(b=this.table._ai),this._data[a]=b):(c=this.table.cols[a],b=c.set(b),null===b&&c.autoIncrement&&(b=this.table._ai),this._data[this._cellsByName[a]]=b),this},qb.prototype.getCellValue=function(a){return t(a)?this.getCellAt(a):this.getCell(a)},qb.prototype.toJSON=function(a){var b={};for(var c in this._cellsByName)b[c]=this._data[this._cellsByName[c]];if(a)for(var d=0;d<this.length;d++)b[d]=this._data[d];return b},rb.TYPE_INDEX=2,rb.TYPE_UNIQUE=4,rb.TYPE_PRIMARY=8,rb.compare=function(a,b){return a===b?0:a>b?1:-1},rb.fromJSON=function(a,b){var c=new rb(b,a.columns,a.type,a.name);return c},rb.prototype={init:function(){var a,b,c,d,e,f=this.table._row_seq,g=this.table.rows,h=this.table._length,i=this.columns.length;for(this._index=[],c=0;h>c;c++){for(b=f[c],a=[],d=0;i>d;d++)a.push(g[b].getCell(this.columns[d]));a=a.join(""),e=u(this._index,a,rb.compare),this._index.splice(0>e?-e-1:e+1,0,a)}},getValueForRow:function(a){var b,c="",d=this.columns.length;if(0===d)return c;if(1===d)return String(a instanceof qb?a.getCell(this.columns[0]):a[this.columns[0]]);for(b=0;d>b;b++)c.push(a instanceof qb?a.getCell(this.columns[b]):a[this.columns[b]]);return c.join("")},beforeInsert:function(a){var b,c,d=[];for(b=0;b<this.columns.length;b++)d.push(a.getCell(this.columns[b]));if(d=d.join(""),c=u(this._index,d,rb.compare),c>=0&&this.isUnique())throw new Zb('Duplicate entry for key "%s".',this.name);c=0>c?-c-1:c+1,this._index.splice(c,0,d)},beforeUpdate:function(a,b){var c,d,e=this.getValueForRow(a),f=this.getValueForRow(b);if(e!==f){if(c=u(this._index,e,rb.compare),d=u(this._index,f,rb.compare),d>=0&&this.isUnique())throw new $b('Constraint "%s" violated. The value must be unique and the supplied value "%s" already exists.',this.name,f);c!==d&&(d=0>d?-d-1:d+1,this._index.splice(d,0,f),c=c>=d?c+1:c,this._index.splice(c,1))}},beforeDelete:function(a){var b,c=[];for(b=0;b<this.columns.length;b++)c.push(a.getCell(this.columns[b]));c=c.join(""),b=u(this._index,c,rb.compare),b>=0&&this._index.splice(b,1)},setColumns:function(a){v(a,"array"),this.columns=a.slice()},setType:function(a){switch(a){case rb.TYPE_UNIQUE:this.type=a;break;case rb.TYPE_PRIMARY:if(this.table.primaryKey)throw new Zb("A table can only have one PRIMARY KEY defined");this.type=a,this.table.primaryKey=this;break;default:this.type=a}},setTable:function(a){w(a,Z),this.table=a},setName:function(a){if(v(a,"string","The name of the index must be a string"),a=i(a),z(a,"The name of the index cannot be empty"),a in this.table.keys)throw new Zb('The table %s.%s already have a key named "%s".',this.table._db.name,this.table.name,a);this.name=a},isUnique:function(){return this.type===rb.TYPE_UNIQUE||this.type===rb.TYPE_PRIMARY},toJSON:function(){return{name:this.name,type:this.type,columns:this.columns}}},sb.prototype.setParams=function(){},sb.prototype=new sb,sb.prototype.toString=function(){return this.generateSQL()},tb.prototype=new sb,tb.prototype._name=b,tb.prototype._ifNotExists=!1,tb.prototype.generateSQL=function(){if("string"!=typeof this._name)throw new Zb("Invalid database name");if(!this._name)throw new Zb("No database name");return"CREATE DATABASE "+(this._ifNotExists?"IF NOT EXISTS ":"")+f(this._name,'"')},tb.prototype.execute=function(a){zb.createDatabase(this._name,this._ifNotExists,a)},tb.prototype.ifNotExists=function(a){return a===b?this._ifNotExists:(this._ifNotExists=!!a,this)},tb.prototype.name=function(a){return a?(this._name=String(a),this):this._name},ub.prototype=new sb,ub.prototype._name=b,ub.prototype._temporary=!1,ub.prototype._ifNotExists=!1,ub.prototype.ifNotExists=function(a){return a===b?this._ifNotExists:(this._ifNotExists=!!a,this)},ub.prototype.temporary=function(a){return a===b?this._temporary:(this._temporary=!!a,this)},ub.prototype.generateSQL=function(){},ub.prototype.name=function(a){return a?(this._name=String(a),this):this._name},ub.prototype.addConstraint=function(a){this.constraints.push(a)},ub.prototype.execute=function(a){var b=this;q(b.name(),b.columns,b.ifNotExists(),null,function(c,d){if(c)return a(c,null);var e,f=b.constraints.length;if(!f)return a(null,d);for(e=0;f>e;e++)d.addConstraint(b.constraints[e]);d.save(a)})},a[Cb]=Db,Db.query=S,Db.Result=vb,Db.query2=R,a.JSDB_EXPORT_FOR_TESTING&&C(a.JSDB,{TOKEN_TYPE_UNKNOWN:Fb,TOKEN_TYPE_WORD:Gb,TOKEN_TYPE_NUMBER:Hb,TOKEN_TYPE_OPERATOR:Ib,TOKEN_TYPE_SINGLE_QUOTE_STRING:Jb,TOKEN_TYPE_DOUBLE_QUOTE_STRING:Kb,TOKEN_TYPE_BACK_TICK_STRING:Lb,TOKEN_TYPE_SUBMIT:Mb,TOKEN_TYPE_COMMENT:Nb,TOKEN_TYPE_MULTI_COMMENT:Ob,TOKEN_TYPE_PUNCTOATOR:Pb,TOKEN_TYPE_SPACE:Qb,TOKEN_TYPE_EOL:Rb,TOKEN_TYPE_EOF:Sb,tokenize:K,getTokens:j,Walker:L,Table:Z,TableIndex:rb,SERVER:zb,Column:$,TableRow:qb,binarySearch:u,crossJoin:G,innerJoin:H,crossJoin2:F,executeCondition:E,Transaction:M,Storage:ac,LocalStorage:T,SQLConstraintError:$b,SQLRuntimeError:Zb,SQLParseError:Yb}),vb.TYPE_UNKNOWN=0,vb.TYPE_ARRAY=2,vb.TYPE_SET=4,vb.TYPE_MESSAGE=8,vb.TYPE_BOOL=16,vb.TYPE_MUTATION=32,vb.prototype={setData:function(a){return this._endTime=Date.now(),this.time=this._endTime-this._startTime,this._startTime=this._endTime,a&&"object"==typeof a?(this.data=a,this.cols=a.cols||[],this.rows=a.rows||[],this.type=vb.TYPE_SET):"[object Array]"==Object.prototype.toString.call(a)?(this.data=a,this.rows=a,this.cols=[],this.type=vb.TYPE_ARRAY):a===!0||a===!1?(this.data=a,this.cols=[],this.rows=[],this.type=vb.TYPE_BOOL):(this.data=String(a||""),this.cols=[],this.rows=[],this.type=vb.TYPE_MESSAGE),this.colLength=this.cols.length,this.rowLength=this.rows.length,this},isSuccess:function(){return this.type===vb.TYPE_UNKNOWN?!1:this.type!==vb.TYPE_BOOL||this.data?!0:!1},getMessage:function(){return this.isSuccess()?this.type===vb.TYPE_MESSAGE?this.data:this.type===vb.TYPE_ARRAY||this.type===vb.TYPE_SET?this.rowLength+" rows in set. Query took "+this.time+"ms.":this.type===vb.TYPE_MUTATION?this.data+" rows affected. Query took "+this.time+"ms.":"Query executed successfully in "+this.time+"ms.":"Query failed"},toHTML:function(a){var c,d,e,f,g=[],h=this.cols.length,i=this.rows.length;if(g.push("<table"),a){g.push(" "),c=[];for(f in a)c.push(f+"="+escape(a[f]));g.push(c.join(" "))}for(g.push("><thead><tr>"),d=0;h>d;d++)g.push("<th>",this.cols[d],"</th>");for(g.push("</tr></thead><tbody>"),d=0;i>d;d++){for(c=this.rows[d],g.push("<tr>"),e=0;h>e;e++)f=c[this.cols[e]]||c[e],g.push("<td>",f===b?"":String(f),"</td>");g.push("</tr>")}return g.push("</tbody></table>"),g.join("")},toJSON:function(){var a={message:this.getMessage(),queryTime:this.time,successful:this.isSuccess()};return a.successful&&(this.type===vb.TYPE_MUTATION&&(a.affectedRows=this.data),this.type===vb.TYPE_ARRAY&&(a.rows=this.rows,a.rowLength=this.rowLength),this.type===vb.TYPE_SET&&(a.rows=this.rows,a.cols=this.cols,a.rowLength=this.rowLength,a.colLength=this.colLength)),a},toJSONString:function(a){return JSON.stringify(this.toJSON(),null,a||0)},toString:function(a,c){var d=this,e=[];return this.forEach(function(a){var f,g,h=[];for(f=0;f<d.colLength;f++)g=a[d.cols[f]]||a[f],h.push(g===b?";":String(g));e.push(h.join(c===b?",":String(c)))}),e.join(a===b?"\n":String(a))},toXML:function(a){var c=this,d=["<result>"],e=this.isSuccess();return d.push(a?"\n":"",a||"","<successful>",e,"</successful>"),d.push(a?"\n":"",a||"","<message>",this.getMessage(),"</message>"),d.push(a?"\n":"",a||"","<queryTime>",this.time,"</queryTime>"),e&&(this.type===vb.TYPE_MUTATION&&d.push(a?"\n":"",a||"","<affectedRows>",this.data,"</affectedRows>"),this.type===vb.TYPE_ARRAY&&d.push(a?"\n":"",a||"","<rowLength>",this.rowLength,"</rowLength>"),this.type===vb.TYPE_SET&&(d.push(a?"\n":"",a||"","<rowLength>",this.rowLength,"</rowLength>"),d.push(a?"\n":"",a||"","<colLength>",this.colLength,"</colLength>")),(this.type===vb.TYPE_ARRAY||this.type===vb.TYPE_SET)&&this.forEach(function(e){var f,g,h=[];for(h.push(a?"\n":"",a||"","<row>"),f=0;f<c.colLength;f++)g=e[c.cols[f]]||e[f],h.push(a?"\n":"",a||"",a||"","<property>",g===b?"":String(g),"</property>");h.push(a?"\n":"",a||"","</row>"),d.push(h.join(""))})),d.push(a?"\n":"","</result>"),d.join("")},toCSV:function(){return this.toString("\n",",")},forEach:function(a){for(var b=0;b<this.rowLength&&a(this.rows[b],b,this.rows)!==!1;b++);}};var cc={query:R,config:xb,on:_b.on.bind(_b),one:_b.one.bind(_b),off:_b.off.bind(_b),each:yb,getDatabase:function(a){return o(a,!0)},getCurrentDatabase:function(){return zb.getCurrentDatabase()},getTable:function(a,b){return p(a,b,!0)}};wb.on=cc.on,wb.one=cc.one,wb.off=cc.off,window.jsSQL=wb,function(){Db.events=_b,Db.SERVER=zb=new X,zb.load(function(){},function(a){console.error(a)})}(),wb.version="0.0.303"}(window);