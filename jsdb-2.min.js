!function(a,b){"use strict";function c(a){var b=arguments,c=b.length,d=0;return a.replace(/(%s)/g,function(a,e){return++d>c?e:b[d]})}function d(a){var b,c=a.length;if(0===c)return"";if(1===c)return e(a[0]);if(2==c)return e(a[0])+" or "+e(a[1]);var d,f=[];for(d=0;d<a.length;d++)f.push(e(a[d]));return b=f.pop(),"one of "+f.join(", ")+" or "+b}function e(a,b){return b=b||'"',b+String(a).replace(b,b+""+b)+b}function f(a){a="string"==typeof a?{message:a}:a||{message:"Unknown error"};var b,d,e,f=Array.prototype.slice.call(arguments,1),g=[];throw f.unshift(a.message),b=e=c.apply({},f),g.push("font-weight:bold;color:red;",b),b="%c%s","file"in a&&(b+="%c \n   file: %s",g.push("font-weight:bold;",a.file)),"line"in a&&(b+="%c \n   line: %i",g.push("font-weight:bold",a.line)),"col"in a&&(b+="%c \n column: %i",g.push("font-weight:bold",a.col)),"token"in a&&(b+="%c \n   char: %i",g.push("font-weight:bold",a.token[2]),"src"in a&&(d=Math.max(a.token[2]-50,0),b+="%c \n around: %c%s%c%s%c%s",g.push("font-weight:bold","color:#666","..."+a.src.substring(d,a.token[2]),"color:#000;font-weight:bold;background:orange;padding:3px;border-radius:3px;text-indent:5px;display:inline-block !important;",a.src.substring(a.token[2],a.token[3]).replace(/\n/g,"Â¬\n"),"color:#666",a.src.substr(a.token[3],50)+"..."))),g.unshift(b),console.log.apply(console,g),new SyntaxError(e)}function g(a){return String(a).replace(/^\s+|\s+$/,"")}function h(a,b){function c(){g++}function d(){g--}function e(a){f[h++]=a}var f=[],g=0,h=0;return z(a,e,c,d,b),f}function i(a){var b=g(a);if(!gb.databases.hasOwnProperty(b))throw new C('No such database "%s".',b);hb=gb.databases[b]}function j(a,b,c,d){if(d=d||hb,!d)throw new C("No database selected");return d.createTable(a,b,c)}function k(a,b,c){var d,e,f=arguments.length;if(!(2>f)&&a&&"object"==typeof a)if("[object Array]"==Object.prototype.toString.call(a)){if("function"==typeof a.every)return a.every(b,c);for(e=a.length,d=0;e>d;d++)if(f>2){if(b.call(c,a[d],d,a)===!1)break}else if(b(a[d],d,a)===!1)break}else for(d in a)if(f>2){if(b.call(c,a[d],d,a)===!1)break}else if(b(a[d],d,a)===!1)break}function l(a,b,c){var d,e,f=arguments.length;if(2>f||!a||"object"!=typeof a)return!1;if("[object Array]"==Object.prototype.toString.call(a)){if("function"==typeof a.every)return a.every(b,c);for(e=a.length,d=0;e>d;d++)if(f>2){if(b.call(c,a[d],d,a)===!1)return!1}else if(b(a[d],d,a)===!1)return!1}else for(d in a)if(f>2){if(b.call(c,a[d],d,a)===!1)return!1}else if(b(a[d],d,a)===!1)return!1;return!0}function m(a,b){var c,d=[];for(c in a)(b||a.hasOwnProperty(c))&&d.push(c);return d}function n(){}function o(a){var b;if(a){if(b=gb.databases[a],!b)throw new C('No such database "%s"',a)}else if(b=hb,!b)throw new C("No database selected.");return b}function p(a,b){var c=o(b),d=c.tables[a];if(!d)throw new C('No such table "%s" in database "%s"',a,c.name);return d}function q(a){return"[object Array]"==Object.prototype.toString.call(a)}function r(a){var b=parseFloat(a);return!isNaN(b)&&isFinite(b)}function s(a,c,d,e,f){var g,h;if(e===b)e=0;else if(e=0|e,0>e||e>=a.length)throw new RangeError("invalid lower bound");if(f===b)f=a.length-1;else if(f=0|f,e>f||f>=a.length)throw new RangeError("invalid upper bound");for(;f>=e;)if(g=e+(f-e>>1),h=+d(a[g],c),0>h)e=g+1;else{if(!(h>0))return g;f=g-1}return~e}function t(a,b,c){if(Object.prototype.toString.call(a).toLowerCase()!="[object "+b+"]")throw new TypeError(c||"Invalid type ('"+b+"' is required)")}function u(a,b,c){if(!(a instanceof b))throw new TypeError(c||"Invalid object type")}function v(a,b,c){if(0>a||a>=b.length)throw new RangeError(c||"value out of bounds")}function w(a,b,c){if(!(a in b))throw new Error(c||"No such property '"+a+"'.")}function x(a,b){if(!a)throw new Error(b||"Assertion failed")}function y(a){window.console&&console.error&&console.error(a)}function z(a,b,c,d,e){function g(b){var c=Array.prototype.slice.call(arguments,1);c.unshift({message:b,line:p,col:q,pos:m,src:a,token:i}),f.apply({},c)}function h(){var a,c=t&&o===vb||u&&o===wb||v&&(o===sb||o===tb)||w&&o===ub&&("'"==n||'"'==n||"`"==n);c||(i=[n,o||(/^-?\d+$/.test(n)?mb:n in Ab?nb:lb),r,m],a=b(i)),n="",o=kb,r=m,a&&a!==!0?g(a):a===!1&&(m=-1)}for(var i,j,k,l,m=0,n="",o=kb,p=1,q=0,r=0,s=e||{},t=!!s.skipSpace,u=!!s.skipEol,v=!!s.skipComments,w=!!s.skipStrQuots;j=a[m];){switch(l=o===ob||o===pb||o===qb||o===tb||o===sb,j){case"-":l?n+=j:"-"==a[m+1]?(n&&h(),n=j,o=sb):(o!==nb&&(n&&h(),o=nb),n+=j),m++;break;case"/":o===ob||o===pb||o===qb||o===sb?(n+=j,m++):o===tb?(n+=j,"*"==a[m-1]&&n&&h(),m++):"*"==a[m+1]?(n&&h(),n+=j,o=tb,m++):(o!==nb&&(n&&h(),o=nb),n+=j,m++);break;case"\n":p++,l&&o!==sb?(n+=j,m++,q=0):(n&&h(),o=wb,n+=j,m++,q=0,h());break;case"'":o===ob?a[m+1]==j?(n+=j,m+=2):(h(),n+=j,m++,o=ub,h()):l?(n+=j,m++):(n&&h(),n+=j,m++,o=ub,h(),o=ob);break;case'"':o===pb?a[m+1]==j?(n+=j,m+=2):(h(),n+=j,m++,o=ub,h()):l?(n+=j,m++):(n&&h(),n+=j,m++,o=ub,h(),o=pb);break;case"`":o===qb?a[m+1]==j?(n+=j,m+=2):(h(),n+=j,m++,o=ub,h()):l?(n+=j,m++):(n&&h(),n+=j,m++,o=ub,h(),o=qb);break;case"(":l?(n+=j,m++):(n&&h(),o=ub,n=j,m++,h(),c());break;case")":l?(n+=j,m++):(n&&h(),d(),o=ub,n=j,m++,h());break;case";":l?(n+=j,m++):(n&&h(),m++,o=rb,n=j,h());break;case" ":case"	":l||o===vb||(n&&h(),o=vb),n+=j,m++;break;case"!":l?(n+=j,m++):(n&&h(),o=nb,n+=j,k=a[m+1],("="==k||"<"==k||">"==k)&&(n+=k,m++),h(),m++);break;case"<":l?(n+=j,m++):(n&&h(),o=nb,n+=j,k=a[m+1],("="==k||">"==k)&&(n+=k,m++),h(),m++);break;case">":l?(n+=j,m++):(n&&h(),o=nb,n+=j,k=a[m+1],"="==k&&(n+=k,m++),h(),m++);break;case"=":case"+":case"-":case"*":case"/":case"%":l?(n+=j,m++):(n&&h(),o=nb,n+=j,h(),m++);break;case".":case",":l?n+=j:(n&&h(),o=ub,n+=j,h()),m++;break;case"\\":switch(m++,k=a[m],m++,k){case"0":n+="\x00";break;case"b":n+="\b";break;case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="	";break;case"%":n+="\\%";break;case"_":n+="\\_";break;default:n+=k}break;default:o===vb&&n&&h(),n+=j,m++}q++}if(n&&h(),o===ob)throw"Unexpected end of input. Expecting '.";if(o===pb)throw'Unexpected end of input. Expecting ".';if(o===qb)throw"Unexpected end of input. Expecting `.";if(o===tb)throw"Unexpected end of input. Expecting */.";s.addEOF&&(o=xb,h())}function A(a,b){this._pos=0,this._tokens=a,this._input=b}function B(){this.name="SQLParseError",this.message=c.apply(this,arguments.length?arguments:["Error while parsing sql query"])}function C(){this.name="SQLRuntimeError",this.message=c.apply(this,arguments.length?arguments:["Error while executing sql query"])}function D(a,b){function c(c,d){var e=new A(c,d);e.onComplete=a||n,e.onError=b||y,e.pick({USE:ib.USE(e),SHOW:function(){e.pick({"DATABASES|SCHEMAS":ib.SHOW_DATABASES(e),TABLES:ib.SHOW_TABLES(e),COLUMNS:ib.SHOW_COLUMNS(e)})},CREATE:function(){e.pick({"DATABASE|SCHEMA":ib.CREATE_DATABASE(e),TABLE:ib.CREATE_TABLE(e),"TEMPORARY TABLE":ib.CREATE_TABLE(e)})},DROP:function(){e.pick({"DATABASE|SCHEMA":ib.DROP_DATABASE(e),TABLE:ib.DROP_TABLE(e),"TEMPORARY TABLE":ib.DROP_TABLE(e)})},INSERT:ib.INSERT(e),SELECT:ib.SELECT(e)})}var d;this.parse=function(a){return d=h(a,{skipComments:!0,skipSpace:!0,skipEol:!0,skipStrQuots:!0}),c(d,a)}}function E(a){var b=new D;return b.parse(a)}function F(){this.setMany=function(a,b,c){setTimeout(function(){try{for(var d in a)localStorage.setItem(d,a[d]);b&&b()}catch(e){(c||y)(e)}},0)},this.getMany=function(a,b,c){setTimeout(function(){try{for(var d=[],e=0,f=a.length;f>e;e++)d.push(localStorage.getItem(key));b&&b(d)}catch(g){(c||y)(g)}},0)},this.unsetMany=function(a,b,c){setTimeout(function(){try{for(var d=0,e=a.length;e>d;d++)localStorage.removeItem(key);b&&b()}catch(f){(c||y)(f)}},0)},this.set=function(a,b,c,d){setTimeout(function(){try{localStorage.setItem(a,b),c&&c()}catch(e){(d||y)(e)}},0)},this.get=function(a,b,c){setTimeout(function(){try{b&&b(localStorage.getItem(a))}catch(d){(c||y)(d)}},0)},this.unset=function(a,b,c){setTimeout(function(){try{localStorage.removeItem(a),b&&b()}catch(d){(c||y)(d)}},0)}}function G(){var a={};this.setMany=function(b,c,d){setTimeout(function(){try{for(var e in b)a[e]=b[e];c&&c()}catch(f){(d||y)(f)}},0)},this.getMany=function(b,c,d){setTimeout(function(){try{for(var e=[],f=0,g=b.length;g>f;f++)e.push(a[key]);c&&c(e)}catch(h){(d||y)(h)}},0)},this.unsetMany=function(b,c,d){setTimeout(function(){try{for(var e=0,f=b.length;f>e;e++)a.hasOwnProperty(b[e])&&delete a[b[e]];c&&c()}catch(g){(d||y)(g)}},0)},this.set=function(b,c,d,e){setTimeout(function(){try{a[b]=val,d&&d()}catch(c){(e||y)(c)}},0)},this.get=function(b,c,d){setTimeout(function(){try{c&&c(a[b])}catch(e){(d||y)(e)}},0)},this.unset=function(b,c,d){setTimeout(function(){try{a.hasOwnProperty(b)&&delete a[b],c&&c()}catch(e){(d||y)(e)}},0)}}function H(){}function I(){this.databases={}}function J(a){this.tables={},this.name=a}function K(a,b){this.name=a,this.rows={},this.keys={},this.cols={},this._col_seq=[],this._row_seq=[],this._length=0,this._ai=1,this._db=b}function L(){}function M(){}function N(){}function O(){}function P(){}function Q(){}function R(){}function S(){}function T(){}function U(){}function V(){}function W(){}function X(){}function Y(){}function Z(){}function $(){}function _(a,b){this.id=b,this.table=null,this.length=0,this._cells=[],this._cellsByName={},a&&this.setTable(a)}function ab(a,c){this.setColumn(a),c!==b&&this.setValue(c)}function bb(a,b,c,d){this.columns=[],this._index=[],this.setTable(a),this.setType(c),this.setName(d||b.join("_")),this.setColumns(b),this.init()}function cb(){}function db(a,b,c){try{{var d=new D(b,c);d.parse(a)}}catch(e){(c||y)(e)}}function eb(){}function fb(){this.columns=[]}var gb,hb,ib={},jb="JSDB",kb=0,lb=1,mb=2,nb=3,ob=4,pb=5,qb=6,rb=7,sb=8,tb=9,ub=10,vb=13,wb=14,xb=15,yb=[lb,pb,ob,qb],zb=[mb,pb,ob,qb],Ab={ALL:1,AND:1,ANY:1,BETWEEN:1,EXISTS:1,IN:1,LIKE:1,NOT:1,OR:1,IS:1,UNIQUE:1,IF:1,"!=":1,"<>":1,">=":1,"<=":1,"!<":1,"!>":1,"=":1,">":1,"<":1,"+":1,"-":1,"*":1,"/":1,"%":1},Bb=["BIT","TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","REAL","DOUBLE","FLOAT","DECIMAL","NUMERIC","DATE","TIME","TIMESTAMP","DATETIME","YEAR","CHAR","VARCHAR","BINARY","VARBINARY","TINYBLOB","BLOB","MEDIUMBLOB","LONGBLOB","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","ENUM","SET"],Cb={};Cb[kb]="character",Cb[lb]="word",Cb[mb]="number",Cb[nb]="operator",Cb[ob]="string",Cb[pb]="string",Cb[qb]="string",Cb[rb]="character",Cb[sb]="comment",Cb[tb]="comment",Cb[ub]="punctoator",Cb[vb]="space",Cb[wb]="new line";var Db=function(){function a(a,b){return d[a]||(d[a]=[]),d[a].push(b),b}function b(a,b){if(a)if(b)for(var c=d[a]||[],e=c.length;e--;)c[e]===b&&d[a].splice(e,1);else d[a]=[];else d={}}function c(a,b){var c,e=d[a]||[],f=e.length,g=!1;for(console.info("dispatch: ",a,b),c=0;f>c;c++)if(e[c](b)===!1){g=!0;break}return!g}var d={};return{dispatch:c,bind:a,unbind:b}}();A.prototype={back:function(){if(this._pos<=0)throw new Error("The parser is trying go before the first token");return this._pos--,this},prev:function(){if(this._pos<=0)throw new Error("The parser is trying go before the first token");return this._tokens[this._pos-1]},current:function(){return this._tokens[this._pos]},some:function(a,b){function c(){i=!0}var e,f,g,h,i,j=this._tokens[this._pos],k=[];if(j){for(e in a){if(e.indexOf("|")>0){for(f=e.split(/\s*\|\s*/),g=0;g<f.length;g++)if(b&&f[g]===j[0]||!b&&f[g].toUpperCase()===j[0].toUpperCase())return this._pos++,a[e].call(this),this}else if(e.indexOf(" ")>0){if(i=!1,this.optional(e,c),i)return a[e].call(this),this}else if(b&&e===j[0]||!b&&e.toUpperCase()===j[0].toUpperCase())return this._pos++,a[e].call(this),this;k.push(e)}throw h="the start of the query",this._pos>0&&(h=this._input.substring(0,this._tokens[this._pos][2]),h=h.substring(h.lastIndexOf(this.lookBack(5)[0])),h=h.replace(/[\r\n]/,"").replace(/\t/," "),h=h.replace(/\s+$/,""),h="..."+h),new B('Expecting: %s after "%s"',d(k),h)}return this},any:function(a,b,c){var e,f,g,h=this._tokens[this._pos];if(h)for(a="[object Array]"==Object.prototype.toString.call(a)?a:[a],e=a.length,g=0;e>g;g++)if(f=a[g],f.toUpperCase()===h[0].toUpperCase())return this._pos++,b(h),this;throw c&&c(h),new B("Expecting: %s",d(a))},pick:function(a){return this.some(a)},optional:function(a,b){var c,d=this;if(!a)return this;if("string"==typeof a){var e,f=g(a).toUpperCase().split(/\s+/),h=this.lookAhead(f.length);if(f.join(" ")===h.join(" ").toUpperCase())this._pos+=f.length,b.call(this);else{for(e=0;e<f.length&&e<h.length&&f[e]===h[e].toUpperCase();e++);if(e>0)throw new B('Expecting "%s" after "%s".',f[e],h[e-1])}}else"object"==typeof a&&("[object Array]"==Object.prototype.toString.call(a)?l(a,function(b){var e=!1;return l(b,function(b,f){return c=d._pos,d.optional(f,function(){e=!0,d._tokens.splice(c,d._pos-c),d._pos=c,b(),d.optional(a)}),!e}),!e}):l(a,function(a,b){var c=!1;return this.optional(b,function(){c=!0,a()}),!c},this));return this},someType:function(a,b,c){var e,f,g=this._tokens[this._pos],h=[];if(g){for(e in a){if(a[e]===g[1])return this._pos++,b(g),this;f=Cb[a[e]],-1==h.indexOf(f)&&h.push(Cb[a[e]])}throw new B("Expecting: %s %s",d(h),c||"")}return this},lookAhead:function(a){var b,c=[],d=this._pos,e=d+a;for(d=this._pos;e>d;d++)b=this._tokens[d],b&&c.push(b[0]);return c},lookBack:function(a){var b,c,d=[],e=this._pos-Math.abs(a);for(b=this._pos-1;b>=e&&b>=0;b--)c=this._tokens[b],c&&d.unshift(c[0]);return d},nextUntil:function(a,b){for(var c=this._pos,d=this._tokens[c];d&&d[0]!==a;)b&&b(d),d=this._tokens[++c];return d&&d[0]===a&&(this._pos=c),this},errorUntil:function(a){return this.nextUntil(a,function(a){throw new B('Unexpected %s "%s".',Cb[a[1]],a[0])})},commit:function(a){var b=this._tokens[this._pos];return b&&";"==b[0]&&(this._pos++,a()),this},literalValue:function(a){var b=this._tokens[this._pos],c=zb,e=["NULL","CURRENT_TIME","CURRENT_DATE","CURRENT_TIMESTAMP"],f=["number","string","NULL","CURRENT_TIME","CURRENT_DATE","CURRENT_TIMESTAMP"];if(e.indexOf(b[0])>-1)return this._pos++,a&&a.call(this,b),this;if(c.indexOf(b[1])>-1)return this._pos++,a&&a.call(this,b),this;throw new B('Unexpected %s "%s". Expecting %s.',Cb[b[1]],b[0],d(f))},commaSeparatedList:function(a){var b=this._tokens[this._pos],c=this;if(","==b[0])throw new B('Unexpected ","');return this._pos++,a.call(this,b),this.optional({",":function(){c.commaSeparatedList(a)}}),this},commaSeparatedBlock:function(a,b){var c=this,d=this._pos;return this.pick({"(":function(){var e=c._tokens[c._pos];if(","==e[0])throw new B('Unexpected ","');if(c.commaSeparatedList(a),e=c._tokens[c._pos++],")"!=e[0]){var f="";throw d>0&&(f=c._input.substring(c._tokens[d][2],c._tokens[c._pos][2]),f=f.replace(/\n/,"")),new B(f?'Expecting ")" after %s':'Expecting ")"',f)}b&&b.call(c)}}),this}},A.prototype.walkOnConflictClause=function(a){var b=null,c=this;return c.optional({"ON CONFLICT":function(){c.pick({"ROLLBACK|ABORT|FAIL|IGNORE|REPLACE":function(){b=this.prev()[0].toUpperCase()}})}}),a&&a.call(c,b),c},A.prototype.walkIndexedColumn=function(a){var b={},c=this;return this.someType(yb,function(a){b.name=a[0]}).optional({COLLATE:function(){c.someType(yb,function(a){b.collation=a[0]})}}).optional({ASC:function(){b.sortOrder="ASC"},DESC:function(){b.sortOrder="DESC"}}),a&&a.call(this,b),this},ib.USE=function(a){return function(){var b;a.someType(yb,function(a){b=a[0]}).errorUntil(";").commit(function(){i(b),a.onComplete('Database "'+b+'" selected.')})}},ib.SHOW_DATABASES=function(a){return function(){a.errorUntil(";").commit(function(){a.onComplete({head:["Databases"],rows:m(gb.databases)})})}},ib.SHOW_TABLES=function(a){return function(){a.pick({"FROM|IN":function(){var b;a.someType(yb,function(a){b=a[0]}).nextUntil(";").commit(function(){var c=gb.databases[b];if(!c)throw new C('No such database "%s"',b);a.onComplete({head:['Tables in database "'+b+'"'],rows:m(c.tables)})})}})}},ib.SHOW_COLUMNS=function(a){function c(a){var b=[];return a.unsigned&&b.push("UNSIGNED"),a.zerofill&&b.push("ZEROFILL"),a.autoIncrement&&b.push("AUTO INCREMENT"),b.join(", ")}return function(){var d,f;a.pick({"FROM|IN":function(){a.someType(yb,function(a){f=a[0]})}}).pick({"FROM|IN":function(){a.someType(yb,function(a){d=a[0]})}}).nextUntil(";").commit(function(){var g,h=gb.databases[d];if(!h)throw new C('No such database "%s"',d);if(g=h.tables[f],!g)throw new C('No such table "%s" in databse "%s"',f,d);var i={head:["Field","Type","Null","Key","Default","Extra"],rows:[]};k(g.cols,function(a){var d=a.toJSON();console.log("meta: ",d),i.rows.push([d.name,a.typeToSQL(),d.nullable?"YES":"NO",d.key,"string"==typeof d.defaultValue?e(d.defaultValue,"'"):d.defaultValue===b?"none":d.defaultValue,c(d)])}),a.onComplete(i)})}},ib.CREATE_DATABASE=function(a){return function(){var b=new eb;a.optional("IF NOT EXISTS",function(){b.ifNotExists(!0)}).someType(yb,function(a){b.name(a[0])}).nextUntil(";").commit(function(){b.execute(),a.onComplete('Database "'+b.name()+'" created.')})}},ib.CREATE_TABLE=function(a){function b(){var b=new fb;b.temporary("TEMPORARY"==a.lookBack(2)[0].toUpperCase()),a.optional("IF NOT EXISTS",function(){b.ifNotExists(!0)}).someType(yb,function(a){b.name(a[0])}).optional("(",function(){g(b)}).nextUntil(";").commit(function(){b.execute(),a.onComplete('Table "'+b.name()+'" created.')})}function c(b){a.someType(zb,function(a){b.params.push(a[0])}),a.pick({",":function(){c(b)},")":n})}function e(b){a.commaSeparatedBlock(function(a){b.columns.push(a[0])}),a.walkOnConflictClause(function(a){b.onConflict=a})}function f(){var b={};a.optional("CONSTRAINT",function(){a.someType(yb,function(a){b.name=a[0]},"for the name of the constraint")}),a.pick({"KEY|INDEX":function(){b.type="INDEX",b.columns=[],e(b)},"PRIMARY KEY":function(){b.type="PRIMARY",b.columns=[],e(b)},UNIQUE:function(){b.type="UNIQUE",b.columns=[],e(b)},CHECK:function(){b.type="CHECK"},"FOREIGN KEY":function(){b.type="FOREIGN KEY"}}),console.log("constraint: ",b)}function g(b){var e={};a.someType(yb,function(h){if(h[1]===lb&&h[0].match(/^(CONSTRAINT|KEY|PRIMARY|UNIQUE|CHECK|FOREIGN)$/i)){if(!b.columns.length)throw new B("You have to define some table columns bore defining a table constraint.");a.back(),f()}else e.name=h[0],a.any(Bb,function(b){var d={name:b[0],params:[]};a.optional("(",function(){c(d)}),e.type=d,a.optional([{"NOT NULL":function(){e.nullable=!1},NULL:function(){e.nullable=!0}},{AUTO_INCREMENT:function(){e.autoIncrement=!0}},{KEY:function(){e.key="INDEX"},INDEX:function(){e.key="INDEX"},UNIQUE:function(){a.optional({KEY:n}),e.key="UNIQUE"},"PRIMARY KEY":function(){e.key="PRIMARY"}},{ZEROFILL:function(){e.zerofill=!0}},{UNSIGNED:function(){e.unsigned=!0}},{DEFAULT:function(){a.someType(yb,function(a){e.defaultValue=a[0]})}}])},function(){throw new B('Expecting data type for column "%s" (%s).',e.name,d(Bb))}).pick({",":function(){b.columns.push(e),g(b)},")":function(){b.columns.push(e)}})})}return b},ib.DROP_DATABASE=function(a){return function(){var b={};a.optional("IF EXISTS",function(){b.ifExists=!0}).someType(yb,function(a){b.name=a[0]},"for the database name").errorUntil(";").commit(function(){gb.dropDatabase(b.name,b.ifExists),a.onComplete('Database "'+b.name+'" deleted.')})}},ib.DROP_TABLE=function(a){var b,c,d=!1;return function(){a.optional("IF EXISTS",function(){d=!0}).someType(yb,function(a){b=a[0]}).optional(".",function(){a.someType(yb,function(a){c=b,b=a[0]})}).optional("RESTRICT|CASCADE",function(){}).errorUntil(";").commit(function(){var d,e;if(c){if(d=gb.databases[c],!d)throw new C('No such database "%s"',c)}else if(d=hb,!d)throw new C("No database selected.");if(e=d.tables[b],!e)throw new C('No such table "%s" in databse "%s"',b,c);e.drop(function(){delete d.tables[b],a.onComplete('Table "'+d.name+"."+e.name+'" deleted.')})})}},ib.INSERT=function(a){function b(c){c||(i=[]),a.someType(yb,function(a){i.push(a[0])}).pick({",":function(){b(!0)},")":n})}function c(b){a.literalValue(function(a){var c=a[0];a[1]===lb&&(c=c.toUpperCase(),"NULL"==c&&(c=null)),b.push(c)}).optional({",":function(){c(b)}})}function d(){a.pick({"(":function(){var b=[];c(b),a.pick({")":function(){var a=i.length,c=b.length;if(a!==c)throw new B("The number of inserted values (%s) must match the number of used columns (%s)",c,a);j.push(b)}})}}).optional({",":d})}var e,f,g,h,i,j=[];return function(){a.optional({OR:function(){a.pick({REPLACE:function(){h="REPLACE"},ROLLBACK:function(){h="ROLLBACK"},ABORT:function(){h="ABORT"},FAIL:function(){h="FAIL"},IGNORE:function(){h="IGNORE"}})}}).pick({INTO:n}).someType(yb,function(a){f=a[0]}).optional(".",function(){a.someType(yb,function(a){e=f,f=a[0]})}),g=p(f,e),i=m(g.cols),a.optional({"(":b}).pick({VALUES:d}).errorUntil(";").commit(function(){g.insert(i,j),a.onComplete(j.length+" rows inserted.")})}},ib.SELECT=function(a){return function(){var b,c,d;a.pick({"*|ALL":function(){a.pick({FROM:n}).someType(yb,function(a){b=a[0]}).optional(".",function(){a.someType(yb,function(a){c=b,b=a[0]})}),d=p(b,c),a.errorUntil(";").commit(function(){a.onComplete({head:d._col_seq,rows:d.rows})})}})}},B.prototype=new Error,B.prototype.constructor=B,B.prototype=new Error,B.prototype.constructor=B;var Eb=function(){var a={},b={};return{getEngine:function(c){return b[c]||(b[c]=new a[c]),b[c]},registerEngine:function(b,c){if(a[b])throw new Error('Storage engine "'+b+'" is already registered.');a[b]=c},getEnginePrototype:function(){return{set:function(a,b,c,d){d("Failed to save - not implemented.")},get:function(a,b,c){c("Failed to read - not implemented.")},unset:function(a,b,c){c("Failed to delete - not implemented.")},setMany:function(a,b,c){c("Failed to save - not implemented.")},getMany:function(a,b,c){c("Failed to read - not implemented.")},unsetMany:function(a,b,c){c("Failed to delete - not implemented.")}}}}}();F.prototype=Eb.getEnginePrototype(),F.prototype.constructor=F,Eb.registerEngine("LocalStorage",F),G.prototype=Eb.getEnginePrototype(),G.prototype.constructor=G,Eb.registerEngine("MemoryStorage",G),H.prototype={storage:Eb.getEngine("LocalStorage"),toJSON:function(){return{}},getStorageKey:function(){throw"Please implement the 'getStorageKey' method to return the storage key"},read:function(a,b){this.storage.get(this.getStorageKey(),function(c){try{var d=JSON.parse(c);a(d)}catch(e){b(e)}},b)},write:function(a,b,c){this.storage.set(this.getStorageKey(),JSON.stringify(a),b,c)},drop:function(a,b){this.storage.unset(this.getStorageKey(),a,b)},save:function(a,b){this.write(this.toJSON(),a,b)},load:function(a,b){this.read(a,b)}},I.prototype=new H,I.prototype.constructor=I,I.prototype.getStorageKey=function(){return jb},I.prototype.toJSON=function(){var a={databases:{}};for(var b in this.databases)a.databases[b]=this.databases[b].getStorageKey();return a},I.prototype.load=function(a,b){var c=this;return JSDB.events.dispatch("loadstart:server",c),this.read(function(d){function e(b){return function(){c.databases[b.name]=b,++k===i&&(JSDB.events.dispatch("load:server",c),a.call(c))}}if(!d)return JSDB.events.dispatch("load:server",c),void a.call(c);var f,g,h=[],i=0,j=0,k=0;c.databases={};for(f in d.databases)g=new J(f),h[i++]=g;for(j=0;i>j;j++)g=h[j],g.load(e(g),b)},b),this},I.prototype.createDatabase=function(a,b){if("string"!=typeof a)throw new C("Invalid database name");if(!a)throw new C("No database name");if(this.databases.hasOwnProperty(a)){if(!b)throw new C('Database "'+a+'" already exists');return this.databases[a]}var c=new J(a);return c.save(),this.databases[a]=c,this.save(),c},I.prototype.dropDatabase=function(a,b){if(this.databases.hasOwnProperty(a))this.databases[a].drop(),delete this.databases[a],this.save();else if(!b)throw new C('Database "'+a+'" does not exist')},J.prototype=new H,J.prototype.constructor=J,J.prototype.toJSON=function(){var a,b={name:this.name,tables:{}};for(a in this.tables)b.tables[a]=[jb,this.name,a].join(".");return b},J.prototype.getStorageKey=function(){return jb+"."+this.name},J.prototype.drop=function(){for(var a in this.tables)this.tables[a].drop();H.prototype.drop.call(this)},J.prototype.load=function(a,b){var c=this;return JSDB.events.dispatch("loadstart:database",c),c.read(function(d){function e(b){return function(){c.tables[b.name]=b,++i===j&&(JSDB.events.dispatch("load:database",c),a&&a(c))}}var f,g,h=[],i=0,j=0;c.tables={};for(var k in d.tables)f=new K(k,c),h[j++]=f;if(j)for(g=0;j>g;g++)f=h[g],f.load(e(f),b);else JSDB.events.dispatch("load:database",c),a&&a(c)},b),c},J.prototype.save=function(a,b){return H.prototype.save.call(this,function(){gb.save(a,b)},b),this},J.prototype.createTable=function(a,b,c){if(this.tables.hasOwnProperty(a)&&!c)throw new C('Table "%s" already exists',a);var d,e=new K(a,this);for(d=0;d<b.length;d++)e.addColumn(b[d]);return e.save(),this.tables[a]=e,this.save(),e},K.prototype=new H,K.prototype.constructor=K,K.prototype.createIndex=function(a){var b;t(a,"object","Invalid argument for Table.createIndex"),t(a.name,"string","Invalid index name"),b=g(a.name),x(b,"Index name is required"),x(!this.keys.hasOwnProperty(b),'Index "%s" already exists'),this.keys[b]={index:[],columns:[],onConflict:null}},K.prototype.toJSON=function(){var a={name:this.name,columns:{},rows:{},keys:{}};for(var b in this.cols)a.columns[b]=this.cols[b].toJSON();for(b in this.rows)a.rows[b]=this.rows[b].getStorageKey();for(b in this.keys)a.keys[b]=this.keys[b].toJSON();return a},K.prototype.getStorageKey=function(){return[jb,this._db.name,this.name].join(".")},K.prototype.addColumn=function(a){var b=L.create(a);switch(b.key){case"PRIMARY":this.keys[b.name]=new bb(this,[b.name],bb.TYPE_PRIMARY,b.name);break;case"UNIQUE":this.keys[b.name]=new bb(this,[b.name],bb.TYPE_UNIQUE,b.name);break;case"KEY":case"INDEX":this.keys[b.name]=new bb(this,[b.name],bb.TYPE_INDEX,b.name)}return this.cols[a.name]=b,this._col_seq.push(a.name),b.key,b},K.prototype.save=function(a,b){var c=this._db;return H.prototype.save.call(this,function(){c.save(a,b)},b),this},K.prototype.load=function(a,b){var c=this;JSDB.events.dispatch("loadstart:table",c),c.read(function(d){function e(b){for(var d in c.keys)c.keys[d].beforeInsert(b);c._ai=Math.max(c._ai,b.id)+1,c.rows[b.id]=b,c._length++,c._row_seq.push(b.id),0===--g&&(JSDB.events.dispatch("load:table",c),a&&a(c))}var f,g=0;if(d){c.cols={},c.rows={},c.keys={};for(f in d.columns)c.addColumn(d.columns[f]);if(d.keys){c.keys={},c.primaryKey=null;for(f in d.keys)c.keys[f]=bb.fromJSON(d.keys[f],c)}for(var h in d.rows)c.rows[h]=new _(c,h),g++;if(g)for(h in c.rows)c.rows[h].load(e,b);else JSDB.events.dispatch("load:table",c),a&&a(c)}},b)},K.prototype.insert=function(a,b){{var c,d,e,f=a.length,g=b.length;this._col_seq.length}for(d=0;g>d;d++){for(e=new _(this,this._ai),c=0;f>c;c++)e.setCellValue(a[c],b[d][c]);for(c in this.keys)this.keys[c].beforeInsert(e);this.rows[this._ai++]=e,this._length++,this._row_seq.push(this._ai-1),e.save()}this.save()},K.prototype.drop=function(a,b){function c(){0===--f&&H.prototype.drop.call(e,a,b)}var d,e=this,f=e._length;for(d in e.rows)e.rows[d].drop(c,b)};var Fb={BIT:N,TINYINT:Q,SMALLINT:R,MEDIUMINT:S,INT:O,INTEGER:P,BIGINT:T,DOUBLE:W,FLOAT:X,DECIMAL:U,NUMERIC:V,CHAR:$,VARCHAR:Z};L.constructors=Fb,L.prototype={length:-1,name:null,type:null,nullable:!1,typeParams:[],setName:function(a){if(a&&(a=g(a)))return this.name=a,this;throw new C('Invalid column name "%s".',a)},setKey:function(a){a=String(a).toUpperCase(),this.key="KEY"==a||"INDEX"==a||"UNIQUE"==a||"PRIMARY"==a?a:b},setDefaultValue:function(a){this.defaultValue=a===b?a:this.set(a)},init:function(a){return this.setName(a.name),this.setKey(a.key),this.setDefaultValue(a.defaultValue),this.nullable=!!a.nullable,this},toJSON:function(){var a={name:this.name,key:this.key,defaultValue:this.defaultValue,nullable:!!this.nullable,type:{name:this.type,params:[this.length]}};return a},typeToSQL:function(){var a=[this.type];return this.typeParams.length&&a.push("(",this.typeParams.join(", "),")"),a.join("")}},L.create=function(a){var b,c=a.type.name.toUpperCase(),d=Fb[c];if(!d)throw new C('Unknown data type "%s".',a.type.name);return b=new d,b.init.call(b,a),b},M.prototype=new L,M.prototype.constructor=M,M.prototype.unsigned=!1,M.prototype.zerofill=!1,M.prototype.autoIncrement=!1,M.prototype.minUnsigned=0,M.prototype.minSigned=-1,M.prototype.maxUnsigned=2,M.prototype.maxSigned=1,M.prototype.max=1,M.prototype.min=-1,M.prototype.init=function(a){this.setUnsigned(a.unsigned),q(a.type.params)&&a.type.params.length>0&&(this.setLength(a.type.params[0]),this.typeParams=[this.length]),this.setAutoIncrement(a.autoIncrement),this.zerofill=!!a.zerofill,L.prototype.init.call(this,a)},M.prototype.setAutoIncrement=function(a){this.autoIncrement=!!a},M.prototype.setUnsigned=function(a){this.unsigned=!!a,this.min=this.unsigned?this.minUnsigned:this.minSigned,this.max=this.unsigned?this.maxUnsigned:this.maxSigned},M.prototype.setLength=function(a){var b=String(this.max).length;if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>b)throw new C('Invalid length for column "%s". The length must be between 1 and %s inclusive.',this.name,b);this.length=a},M.prototype.toJSON=function(){var a={name:this.name,unsigned:this.unsigned,zerofill:this.zerofill,key:this.key,defaultValue:this.defaultValue===b?this.defaultValue:String(this.defaultValue),autoIncrement:this.autoIncrement,nullable:this.nullable,type:{name:this.type,params:this.typeParams.slice()}};return a},M.prototype.toSQL=function(){var a=[e(this.name),this.typeToSQL(),this.nullable?"NULL":"NOT NULL"];return this.unsigned&&a.push("UNSIGNED"),this.zerofill&&a.push("ZEROFILL"),this.autoIncrement&&a.push("AUTO_INCREMENT"),"PRIMARY"==this.key?a.push("PRIMARY KEY"):"UNIQUE"==this.key?a.push("UNIQUE"):"INDEX"==this.key&&a.push("KEY"),this.defaultValue!==b&&a.push("DEFAULT",e(this.defaultValue,"'")),a.join(" ")},N.prototype=new M,N.prototype.constructor=N,N.prototype.type="BIT",N.prototype.init=function(a){if(M.prototype.init.call(this,a),q(a.type.params)&&a.type.params.length>0){if(1!==a.type.params.length)throw new C('Invalid data type declaration for column "%s". The syntax is "INT[(length)]".',a.name);this.setLength(a.type.params[0]),this.typeParams=[this.length]}},N.prototype.setLength=function(a){if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>64)throw new C('Invalid length for column "%s". The length must be between 1 and 64 inclusive.',this.name);this.length=a},N.prototype.set=function(a){var b,c=String(a),d=c.length;if(d>this.length)throw new C('The data ("%s") is too long for the field "%s". It may contain up to %s bits',c,this.name,this.length);if(b=parseInt(c,2),isNaN(b)||!isFinite(b))throw new C('Invalid bit field value for column "%s". Expecting up to %s bits as binary number literal',this.name,this.length);for(;d++<this.length;)c="0"+c;return c},O.prototype=new M,O.prototype.constructor=O,O.prototype.type="INT",O.prototype.minUnsigned=0,O.prototype.minSigned=-2147483648,O.prototype.maxUnsigned=4294967295,O.prototype.maxSigned=2147483647,O.prototype.init=function(a){if(M.prototype.init.call(this,a),q(a.type.params)&&a.type.params.length>0){if(1!==a.type.params.length)throw new C('Invalid data type declaration for column "%s". The syntax is "INT[(length)]".',a.name);this.setLength(a.type.params[0]),this.typeParams=[this.length]}},O.prototype.setLength=function(a){var b=String(this.minSigned).length;if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||1>a||a>b)throw new C('Invalid length for column "%s". The length must be between 1 and %s inclusive.',this.name,b);this.length=a},O.prototype.set=function(a){if(null===a){if(this.nullable)return a;throw new C('Column "%s" cannot be NULL.',this.name)}var b=parseInt(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new C('Invalid value for column "%s". Expecting an integer between %s and %s.',this.name,this.min,this.max);return b},P.prototype=new O,P.prototype.constructor=P,P.prototype.type="INTEGER",Q.prototype=new O,Q.prototype.constructor=Q,Q.prototype.type="TINYINT",Q.prototype.minUnsigned=0,Q.prototype.minSigned=-128,Q.prototype.maxUnsigned=255,Q.prototype.maxSigned=127,R.prototype=new O,R.prototype.constructor=R,R.prototype.type="SMALLINT",R.prototype.minUnsigned=0,R.prototype.minSigned=-32768,R.prototype.maxUnsigned=65535,R.prototype.maxSigned=32767,S.prototype=new O,S.prototype.constructor=S,S.prototype.type="MEDIUMINT",S.prototype.minUnsigned=0,S.prototype.minSigned=-8388608,S.prototype.maxUnsigned=16777215,S.prototype.maxSigned=8388607,T.prototype=new O,T.prototype.constructor=T,T.prototype.type="BIGINT",T.prototype.minUnsigned=0,T.prototype.minSigned=-0x8000000000000000,T.prototype.maxUnsigned=0x10000000000000000,T.prototype.maxSigned=0x8000000000000000,U.prototype=new M,U.prototype.constructor=U,U.prototype.type="DECIMAL",U.prototype.length=10,U.prototype.decimals=0,U.prototype.minUnsigned=O.prototype.minUnsigned,U.prototype.minSigned=O.prototype.minSigned,U.prototype.maxUnsigned=O.prototype.maxUnsigned,U.prototype.maxSigned=O.prototype.maxSigned,U.prototype.min=O.prototype.minUnsigned,U.prototype.max=O.prototype.maxUnsigned,U.prototype.init=function(a){if(M.prototype.init.call(this,a),q(a.type.params)){if(1!==a.type.params.length)throw new C('Invalid data type declaration for column "%s". The syntax is "%s[(length)]".',a.name,this.type.toUpperCase());
this.setLength(a.type.params[0]),this.typeParams=[this.length]}this.setDefaultValue(a.defaultValue)},U.prototype.set=function(a){var b=parseFloat(a);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new C('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);return b=Number(a).toPrecision(this.length),Number(b).toFixed(this.decimals)},V.prototype=new U,V.prototype.constructor=V,V.prototype.type="NUMERIC",W.prototype=new M,W.prototype.constructor=W,W.prototype.type="DOUBLE",W.prototype.length=10,W.prototype.decimals=1,W.prototype.minUnsigned=O.prototype.minUnsigned,W.prototype.minSigned=O.prototype.minSigned,W.prototype.maxUnsigned=O.prototype.maxUnsigned,W.prototype.maxSigned=O.prototype.maxSigned,W.prototype.init=function(a){if(M.prototype.init.call(this,a),q(a.type.params)){if(1!==a.type.params.length)throw new C('Invalid data type declaration for column "%s". The syntax is "%s[(length)]".',a.name,this.type.toUpperCase());this.setLength(a.type.params[0]),this.typeParams=[this.length]}},W.prototype.set=function(a){var b=parseFloat(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new C('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);b=Number(a).toPrecision(this.length);var c=Math.pow(10,this.decimals);return Math.round(b*c)/c},X.prototype=new M,X.prototype.constructor=X,X.prototype.type="FLOAT",X.prototype.length=10,X.prototype.decimals=2,X.prototype.minUnsigned=O.prototype.minUnsigned,X.prototype.minSigned=O.prototype.minSigned,X.prototype.maxUnsigned=O.prototype.maxUnsigned,X.prototype.maxSigned=O.prototype.maxSigned,X.prototype.init=function(a){if(M.prototype.init.call(this,a),q(a.type.params)){if(1!==a.type.params.length)throw new C('Invalid data type declaration for column "%s". The syntax is "%s[	(length)]".',a.name,this.type.toUpperCase());this.setLength(a.type.params[0]),this.typeParams=[this.length]}},X.prototype.set=function(a){var b=parseFloat(a,10);if(isNaN(b)||!isFinite(b)||b<this.min||b>this.max)throw new C('Invalid value for column "%s". Expecting a number between %s and %s.',this.name,this.min,this.max);b=Number(a).toPrecision(this.length);var c=Math.pow(10,this.decimals);return Math.round(b*c)/c},Y.prototype=new L,Y.prototype.constructor=Y,Y.prototype.type="STRING",Y.prototype.length=-1,Y.prototype.maxLength=Number.MAX_VALUE,Y.prototype.init=function(a){q(a.type.params)&&a.type.params.length>0&&"-1"!=String(a.type.params[0])&&(this.setLength(a.type.params[0]),this.typeParams=[this.length]),L.prototype.init.call(this,a)},Y.prototype.setLength=function(a){if(a=parseInt(a,10),isNaN(a)||!isFinite(a)||0>a)throw new C('Invalid length for column "%s". The length must be a positive integer.',this.name);this.length=Math.min(a,this.maxLength)},Y.prototype.set=function(a){var b,c=String(a);if(-1==this.length)return c;if(b=c.length,b>this.length)throw new C('Truncated value for column "%s".',this.name);return c},Y.prototype.toSQL=function(){var a=[e(this.name),this.typeToSQL(),this.nullable?"NULL":"NOT NULL"];return"PRIMARY"==this.key?a.push("PRIMARY KEY"):"UNIQUE"==this.key?a.push("UNIQUE"):"INDEX"==this.key&&a.push("KEY"),this.defaultValue!==b&&a.push("DEFAULT",e(this.defaultValue,"'")),a.join(" ")},Z.prototype=new Y,Z.prototype.constructor=Z,Z.prototype.type="VARCHAR",Z.prototype.length=-1,Z.prototype.maxLength=65535,$.prototype=new Y,$.prototype.constructor=$,$.prototype.type="CHAR",$.prototype.length=-1,$.prototype.maxLength=65535,_.prototype=new H,_.prototype.constructor=_,_.prototype.getStorageKey=function(){return[jb,this.table._db.name,this.table.name,this.id].join(".")},_.prototype.load=function(a,b){var c=this;JSDB.events.dispatch("loadstart:row",c),this.read(function(b){for(var d=0;d<c.length;d++)c._cells[d].setValue(b[d]);JSDB.events.dispatch("load:row",c),a(c)},b)},_.prototype.save=function(a,b){var c=this;JSDB.events.dispatch("savestart:row",c),c.write(this.toArray(),function(){JSDB.events.dispatch("save:row",c),a(c)},b)},_.prototype.setTable=function(a){var b,c,d;u(a,K),this.length=0,this._cellsByName={},this.table=a;for(b in a.cols)c=a.cols[b],d=new ab(c),this.length=this._cells.push(d),this._cellsByName[b]=d;return this},_.prototype.getCell=function(a){return w(a,this._cellsByName,'No such field "'+a+'".'),this._cellsByName[a]},_.prototype.getCellAt=function(a){return v(a,this._cells,'No field at index "'+a+'".'),this._cells[a]},_.prototype.setCellValue=function(a,b){var c=r(a)?this.getCellAt(a):this.getCell(a);return c.setValue(b),this},_.prototype.getCellValue=function(a){return r(a)?this.getCellAt(a).value:this.getCell(a).value},_.prototype.toArray=function(){var a,b=[];for(a=0;a<this.length;a++)b[a]=this._cells[a].value;return b},_.prototype.toJSON=function(){var a={};for(var b in this._cellsByName)a[b]=this._cellsByName[b].value;return a},ab.prototype={value:null,setColumn:function(a){return u(a,L),this.column=a,this},setValue:function(a){return this.value=this.column.set(a),this},valueOf:function(){return this.value}},bb.TYPE_INDEX=2,bb.TYPE_UNIQUE=4,bb.TYPE_PRIMARY=8,bb.compare=function(a,b){return a===b?0:a>b?1:-1},bb.fromJSON=function(a,b){var c=new bb(b,a.columns,a.type,a.name);return c},bb.prototype={init:function(){var a,b,c,d,e,f=this.table._row_seq,g=this.table.rows,h=this.table._length,i=this.columns.length;for(this._index=[],c=0;h>c;c++){for(b=f[c],a=[],d=0;i>d;d++)a.push(g[b].getCell(this.columns[d]).value);a=a.join(""),e=s(this._index,a,bb.compare),this._index.splice(0>e?-e-1:e+1,0,a)}},beforeInsert:function(a){var b,c,d=[];for(b=0;b<this.columns.length;b++)d.push(a.getCell(this.columns[b]).value);if(d=d.join(""),c=s(this._index,d,bb.compare),c>=0&&this.isUnique())throw new C('Duplicate entry for key "%s".',this.name);c=0>c?-c-1:c+1,this._index.splice(c,0,d)},beforeUpdate:function(){},beforeDelete:function(){},setColumns:function(a){t(a,"array"),this.columns=a.slice()},setType:function(a){switch(a){case bb.TYPE_UNIQUE:this.type=a;break;case bb.TYPE_PRIMARY:if(this.table.primaryKey)throw new C("A table can only have one PRIMARY KEY");this.type=a,this.table.primaryKey=this;break;default:this.type=a}},setTable:function(a){u(a,K),this.table=a},setName:function(a){if(t(a,"string","The name of the index must be a string"),a=g(a),x(a,"The name of the index cannot be empty"),a in this.table.keys)throw new C('The table %s.%s already have a key named "%s".',this.table._db.name,this.table.name,a);this.name=a},isUnique:function(){return this.type===bb.TYPE_UNIQUE||this.type===bb.TYPE_PRIMARY},toJSON:function(){return{name:this.name,type:this.type,columns:this.columns}}},cb.prototype.setParams=function(){},cb.prototype=new cb,cb.prototype.toString=function(){return this.generateSQL()},eb.prototype=new cb,eb.prototype._name=b,eb.prototype._ifNotExists=!1,eb.prototype.generateSQL=function(){if("string"!=typeof this._name)throw new C("Invalid database name");if(!this._name)throw new C("No database name");return"CREATE DATABASE "+(this._ifNotExists?"IF NOT EXISTS ":"")+e(this._name,'"')},eb.prototype.execute=function(){gb.createDatabase(this._name,this._ifNotExists)},eb.prototype.ifNotExists=function(a){return a===b?this._ifNotExists:(this._ifNotExists=!!a,this)},eb.prototype.name=function(a){return a?(this._name=String(a),this):this._name},fb.prototype=new cb,fb.prototype._name=b,fb.prototype._temporary=!1,fb.prototype._ifNotExists=!1,fb.prototype.ifNotExists=function(a){return a===b?this._ifNotExists:(this._ifNotExists=!!a,this)},fb.prototype.temporary=function(a){return a===b?this._temporary:(this._temporary=!!a,this)},fb.prototype.generateSQL=function(){},fb.prototype.name=function(a){return a?(this._name=String(a),this):this._name},fb.prototype.execute=function(){j(this.name(),this.columns,this.ifNotExists(),null)},a.JSDB={TOKEN_TYPE_UNKNOWN:kb,TOKEN_TYPE_WORD:lb,TOKEN_TYPE_NUMBER:mb,TOKEN_TYPE_OPERATOR:nb,TOKEN_TYPE_SINGLE_QUOTE_STRING:ob,TOKEN_TYPE_DOUBLE_QUOTE_STRING:pb,TOKEN_TYPE_BACK_TICK_STRING:qb,TOKEN_TYPE_SUBMIT:rb,TOKEN_TYPE_COMMENT:sb,TOKEN_TYPE_MULTI_COMMENT:tb,TOKEN_TYPE_PUNCTOATOR:ub,TOKEN_TYPE_SPACE:vb,TOKEN_TYPE_EOL:wb,TOKEN_TYPE_EOF:xb,tokenize:z,getTokens:h,parse:E,query:db,Table:K,SERVER:gb,Column:L,TableRow:_,TableCell:ab,binarySearch:s},function(){JSDB.events=Db,JSDB.SERVER=gb=new I,gb.load(function(){},function(a){console.error(a)})}()}(window);